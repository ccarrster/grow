/*! nibunan 17-09-2017 */
function EventHandler(a){var b=a,c=this;c.createEvent=function(a){b[a+"EventListeners"]=[],b[a]=function(c){return b[a+"EventListeners"].push(c),c}},c.raiseEvent=function(a,c){for(var d=0;d<b[a+"EventListeners"].length;d++)b[a+"EventListeners"][d](c)},c.ClearEvent=function(a){b[a+"EventListeners"].splice(0,b[a+"EventListeners"].length),b[a+"EventListeners"]=null},c.removeEvent=function(a,c){for(var d=0;d<b[a+"EventListeners"].length;d++)if(b[a+"EventListeners"][d]===c){b[a+"EventListeners"][d].splice(d,1);break}}}function Geoport(){function a(){b.Canvas.width=window.innerWidth,b.Canvas.height=window.innerHeight,b.ViewPort.Width=b.Canvas.width,b.ViewPort.Height=b.Canvas.height,b.resizeSurface(),f&&f.raiseEvent("resized"),b.Refresh()}var b=this,c=[];b.onSetCamara=function(a){c.push(a)};var d=document.getElementById("geoport");d||(d=document.getElementsByTagName("body")[0]);var e=document.createElement("canvas");e.setAttribute("width","700"),e.setAttribute("height","450"),d.appendChild(e),this.Canvas=e,this.ViewPort=new ViewPort(e),this.resizeSurface=function(){if(this.Shapes.length>0)for(var a=this.Shapes[0].value,b=new Point3D(1366,0,0),c=0;1e4>c;c+=100){b.z=-c;var d=this.GetProjectedPoint1(b);if(d.x<=window.innerWidth){a.Location.z=-c;break}}},window.onresize=function(){a()},this.ViewPort.AddPaint3DEventListener(new Paint3DEventListener(function(a){b.viewport_Paint(a)})),this.LookDirection=new Point3D(0,0,-1500),this.CameraPosition=new Point3D(0,0,1500),this.background=new Color(0,0,0,255),this.ClipRectLocation=new Point(0,0),this.Listeners=new Array,this.KeyPressEventListeners=new Array,this.SurfaceMouseDownEventHandlers=[],this.SurfaceMouseMoveEventHandlers=[],this.SurfaceMouseUpEventHandlers=[],this.PaintInitEventListeners=new Array,this.ViewPort.AddKeyPressEventListener(new KeyPressEventListener(function(a){b.OnKeyPress(a)})),this.ViewPort.AddSurfaceMouseDownEventListener(function(a){b.OnMouseDown(a)}),this.ViewPort.AddSurfaceMouseMoveEventListener(function(a){b.OnMouseMove(a)}),this.ViewPort.AddSurfaceMouseUpEventListener(function(a){b.OnMouseUp(a)}),this.ViewPort.AddTouchStartEventListener(function(a){b.OnTouchStart(a)}),this.ViewPort.AddTouchEndEventListener(function(a){b.OnTouchEnd(a)}),b.Create2dContext=function(){var a=new Surface2D(new Point3D(0,0,0),new Size(window.innerWidth,window.innerHeight));return b.AddShape(a),a},b.get2dContext=function(){return b.Shapes.length>0?b.Shapes[0].value:b.Create2dContext()};var f=new EventHandler(b);f.createEvent("levelInit"),f.createEvent("resized"),this.eventHandler=f,b.LoadFromFile=function(a){getXML&&getXML(a,function(a){f.raiseEvent("levelInit",a),b.LoadFromElement(a)})},b.LoadFromElement=function(a){b.RemoveAll();var a=a.documentElement;if(null!=a){for(var c=0;c<a.attributes.length;c++){var d=a.attributes[c];switch(d.name){case"BackgroundColor":var e=d.value.split(",");b.background=new Color(parseInt(e[0]),parseInt(e[1]),parseInt(e[2]));break;case"BackgroundImageUrl":var f=new Image;f.onload=function(){b.BackgroundImage=f},f.src=d.value;break;case"CameraPosition":var e=d.value.split(",");b.CameraPosition=new Point3D(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]));break;case"LookDirection":var e=d.value.split(",");b.LookDirection=new Point3D(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]));break;case"ClipRectLocation":var e=d.value.split(",");b.ClipRectLocation=new Point(parseInt(e[0]),parseInt(e[1]))}}for(var c=0;c<a.childNodes.length;c++){var g=a.childNodes[c];if(g.attributes){var h=Shape.prototype.From(g);b.AddShape(h)}}var i=a.getAttribute("index"),j=a.getAttribute("order");i=i?i:-1,j=j?j:-1;var k={index:parseInt(i),order:parseInt(j)};this.InvokeLoadedEvent(k),this.ApplyRunnerSettings(),this.Refresh()}},this.ApplyRunnerSettings=function(){for(var a=0;a<this.Shapes.length;a++)this.Shapes[a].value.ApplyRunnerSettings();this.resizeSurface()},this.SetCamera=function(a,b){this.CameraPosition=new Point3D(this.CameraPosition.x+a,this.CameraPosition.y+b,this.CameraPosition.z),this.ClipRectLocation.y+=b,this.ClipRectLocation.x+=a;for(var d=0;d<c.length;d++)c[d](a,b)},a()}function GeoportDesigner(){function a(a){if(l){var b=a,c=n.x-b.x,d=n.y-b.y;f.CameraPosition=new Point3D(f.CameraPosition.x+c,f.CameraPosition.y+d,f.CameraPosition.z),f.Refresh(),n=b}}function b(a,b,c){var d=b,e=n.x-d.x,f=n.y-d.y;n=d,a.MoveResize(e,f,c)}function c(a,b){null!=a&&null!=b&&HandleControlPoint(b)}function d(a){var b=f.GetControlPoint(a);if(b!=g.None){var c=f.GetShape2D(a);null!=c&&(j?(j=!1,i=null,s=0):(p=c,f.ObjectSelected=c,o=b),k&&(j=!0,k=!1))}}function e(a,b){var c=b;if(null!=c&&null!=p)if(p!=b){var d=!1;p.CanAddControlPoint&&p.CanAddControlPoint()&&(p.AddControlPoint(a),d=!0),d||r()}else c.CanInsertControlPoint()&&c.InsertControlPoint(a)}function c(a,b){var c=f.Shapes[0].value.pickAtScreen(b,!0);if(null!=c)Keyboard.isCtrlKeyDown?e(a,c):(p!=c&&r(),c.IsSelectable&&(c.Select(),p=c));else if(null!=p){var d=!1;if(Keyboard.isCtrlKeyDown){var g=p;g.CanAddControlPoint&&g.CanAddControlPoint()&&(g.AddControlPoint(a),d=!0)}d||r()}else r()}Geoport.call(this);var f=this,g={None:0},h={Left:0,Right:2,Midddle:1};this.ObjectPicked=null;var i,j=!1,k=!1;this.enableMagicSelectionMode=function(a){k=a},this.setMagicSelection=function(a){i=a};var l=!1,m=!1,n=null,o=g.None,p=null;this.EventHandler=new EventHandler(this),this.EventHandler.createEvent("objectSelected");var q=0;this.geoport_MouseUp=function(a){var b=new Point3D(a.x,a.y-q,0);if(null!=f.ObjectPicked&&f.ObjectPicked.OnMouseUp(b),m&&0==o){var c=new Point(a.x,a.y-q),d=f.Shapes[0].value.pickAtScreen(c,!0);if(null!=d&&null!=p&&d!=p&&d.Add&&null!=p.ParentContainer){p.ParentContainer.Remove(p);var e=p.GetRelativePosition(p.Location);p.Origin=d.Location;var g=new Point(e.x-d.Location.x,e.y-d.Location.y);p.Location=g,d.Add(p),f.Refresh()}}l=!1,m=!1};var r=function(){null!=p&&(p.Deselect(),p=null)};this.DeselectAll=r,this.geoport_MouseDown=function(a){o=g.None,n=new Point(a.actual.x,a.actual.y-q),a.button==h.Left&&(Keyboard.isCtrlKeyDown?l=!0:m=!0);var b=new Point3D(a.x,a.y-q,0),e=f.Shapes[0].value.pickAtScreen(b,!0);if(null!=e){var i=f.GetAnchor(e);null!=i?d(i):(e.OnMouseDown(b),f.ObjectSelected!=e&&(f.ObjectSelected=e,f.EventHandler.raiseEvent("objectSelected",{sender:f,selectedObject:e})),f.ObjectPicked=e,c(new Point(a.x,a.y-q),b))}else null!=p&&r()};var s=0;this.geoport_MouseMove=function(c){var d=new Point3D(c.x,c.y-q,0),e=f.Shapes[0].value.pickAtScreen(d,!0);return f.ObjectPicked=e,null!=e&&(f.ObjectPicked.OnMouseMove(d),j)?(s%20==0&&i.AddControlPoint(d),void s++):(l&&a(new Point(c.actual.x,c.actual.y-q)),m?null!=p?void b(p,new Point(c.actual.x,c.actual.y-q),o):void 0:void 0)},this.BringToFront=function(){}}function ViewPort(a){this.Canvas=a,this.Canvas.onkeydown=function(){},this.Canvas.onkeyup=function(){},document.oncontextmenu=function(){};var b=this;this.Canvas.onmousedown=function(a){a.preventDefault(),b.InvokeSurfaceMouseDownEvent(a)},this.Canvas.onmousemove=function(a){b.InvokeSurfaceMouseMoveEvent(a)},this.Canvas.onmouseup=function(a){a.preventDefault(),b.InvokeSurfaceMouseUpEvent(a)},this.Canvas.addEventListener("touchstart",function(a){a.preventDefault(),"touchstart"===a.type&&b.InvokeTouchStartEvent(a)},!1),this.Canvas.addEventListener("touchend",function(a){a.preventDefault(),b.InvokeTouchEndEvent(a)},!1),this.Canvas.onkeydown=function(a){b.OnKeyPress(a)},this.Listeners=[],this.KeyPressEventListeners=[],this.SurfaceMouseDownEventHandlers=[],this.SurfaceMouseMoveEventHandlers=[],this.SurfaceMouseUpEventHandlers=[],this.TouchStartEventHandlers=[],this.TouchEndEventHandlers=[],this.DrawingContext=this.Canvas.getContext("2d"),this.DrawPolygon=function(a,b){var c=this.GetColorStyle(b.Color);this.DrawingContext.strokeStyle=c,this.DrawingContext.lineWidth=b.BorderWidth,this.DrawingContext.fillStyle=this.GetColorStyle(b.FillColor),this.DrawingContext.beginPath(),this.DrawingContext.moveTo(a[0].x,a[0].y);for(var d=1;d<a.length;d++)this.DrawingContext.lineTo(a[d].x,a[d].y);this.DrawingContext.closePath(),this.DrawingContext.globalAlpha=b.AlphaFill/255,this.DrawingContext.fill(),b.BorderWidth>0&&(this.DrawingContext.globalAlpha=b.AlphaStroke/255,this.DrawingContext.stroke()),this.DrawingContext.globalAlpha=1},this.DrawRectangle=function(a,b,c,d){if(d.FillColor&&("Rectangle2D3078156810"==d.Name&&console.log(d.Name),this.DrawingContext.fillStyle=this.GetColorStyle(d.FillColor),this.DrawingContext.globalAlpha=d.AlphaFill/255,this.DrawingContext.fillRect(a.x,a.y,b,c)),d.BorderWidth>0&&d.Color){var e=this.GetColorStyle(d.Color);this.DrawingContext.lineWidth=d.BorderWidth,this.DrawingContext.strokeStyle=e,this.DrawingContext.globalAlpha=d.AlphaStroke/255;var f=d.BorderWidth/2;this.DrawingContext.strokeRect(a.x-f,a.y-f,b+2*f,c+2*f)}this.DrawingContext.globalAlpha=1},this.DrawPolyline=function(a,b){var c=this.GetColorStyle(b.Color);this.DrawingContext.strokeStyle=c,b.LineDash&&this.DrawingContext.setLineDash([10,1]),this.DrawingContext.lineWidth=b.BorderWidth,this.DrawingContext.fillStyle=this.GetColorStyle(b.FillColor),this.DrawingContext.beginPath(),this.DrawingContext.moveTo(a[0].x,a[0].y);for(var d=1;d<a.length;d++)this.DrawingContext.lineTo(a[d].x,a[d].y);this.DrawingContext.globalAlpha=b.AlphaFill/255,this.DrawingContext.fill(),b.BorderWidth>0&&(this.DrawingContext.globalAlpha=b.AlphaStroke/255,this.DrawingContext.stroke()),b.LineDash&&this.DrawingContext.setLineDash([0]),this.DrawingContext.globalAlpha=1},this.DrawPolylineCurved=function(a,b){var c=this.GetColorStyle(b.Color);this.DrawingContext.strokeStyle=c,this.DrawingContext.lineWidth=b.BorderWidth,this.DrawingContext.fillStyle=this.GetColorStyle(b.FillColor),this.DrawingContext.beginPath(),this.DrawingContext.moveTo(a[0].x,a[0].y);for(var d=1;d<a.length;d+=3)this.DrawingContext.bezierCurveTo(a[d].x,a[d].y,a[d+1].x,a[d+1].y,a[d+2].x,a[d+2].y);this.DrawingContext.globalAlpha=b.AlphaFill/255,this.DrawingContext.fill(),b.BorderWidth>0&&(this.DrawingContext.globalAlpha=b.AlphaStroke/255,this.DrawingContext.stroke()),this.DrawingContext.globalAlpha=1},this.DrawPolyquadCurve=function(a,b){var c=this.GetColorStyle(b.Color);this.DrawingContext.strokeStyle=c,this.DrawingContext.lineWidth=b.BorderWidth,this.DrawingContext.fillStyle=this.GetColorStyle(b.FillColor),this.DrawingContext.beginPath(),this.DrawingContext.moveTo(a[0].x,a[0].y);for(var d=1;d<a.length;d+=2)this.DrawingContext.quadraticCurveTo(a[d].x,a[d].y,a[d+1].x,a[d+1].y);this.DrawingContext.globalAlpha=b.AlphaFill/255,this.DrawingContext.fill(),b.BorderWidth>0&&(this.DrawingContext.globalAlpha=b.AlphaStroke/255,this.DrawingContext.stroke()),this.DrawingContext.globalAlpha=1},this.Clear=function(a){this.DrawRectangle(new Point(0,0),this.Width,this.Height,{Color:a,FillColor:a,BorderWidth:0,AlphaFill:255})},this.DrawBackgroundImage=function(a){this.DrawingContext.drawImage(a,0,0,this.Width,this.Height)}}function Visual(){this.EventHandler=new EventHandler(this),this.EventHandler.createEvent("mouseDown"),this.EventHandler.createEvent("mouseUp"),this.EventHandler.createEvent("touchStart"),this.EventHandler.createEvent("touchEnd"),this.handleMouseDown=function(a){a.sender=this,this.EventHandler.raiseEvent("mouseDown",a),"None"!==this.MouseDownCommand&&this.Parent.ExecuteCommand(this.MouseDownCommand),this.OnMouseDownLabel&&window[this.OnMouseDownLabel]&&window[this.OnMouseDownLabel](a)},this.handleMouseUp=function(a){a.sender=this,this.EventHandler.raiseEvent("mouseUp",a),this.OnMouseUpLabel&&window[this.OnMouseUpLabel]&&window[this.OnMouseUpLabel]({sender:this})},this.mouseEnter=function(a){a.sender=this,this.OnMouseEnterLabel&&window[this.OnMouseEnterLabel]&&window[this.OnMouseEnterLabel]({sender:this})},this.mouseLeave=function(a){a.sender=this,this.OnMouseLeaveLabel&&window[this.OnMouseLeaveLabel]&&window[this.OnMouseLeaveLabel]({sender:this})},this.touchStart=function(a){a.sender=this,this.OnTouchStartLabel&&window[this.OnTouchStartLabel]&&window[this.OnTouchStartLabel]({sender:this})},this.touchEnd=function(a){a.sender=this,this.OnTouchEndLabel&&window[this.OnTouchEndLabel]&&window[this.OnTouchEndLabel]({sender:this})}}function Shape(){Visual.call(this)}function Line3D(){Shape.call(this)}function Surface2D(a,b){function c(a){for(var b=0;b<i.Shapes.length;b++)if(i.Shapes[b].value==a)return b;return-1}function d(a){var b=new Point3D(a.x,a.y),c=i.pickAtScreen(b,!0);null!=c&&c.OnMouseDown(a)}function e(a){var b=new Point3D(a.x,a.y),c=i.pickAtScreen(b,!0);null!=c&&c.OnMouseUp(a)}function f(a){var b=new Point3D(a.x,a.y),c=i.pickAtScreen(b,!0);null!=c&&c.OnTouchStart(a)}function g(a){var b=new Point3D(a.x,a.y),c=i.pickAtScreen(b,!0);null!=c&&c.OnTouchEnd(a)}function h(a){var b=new Point3D(a.x,a.y),c=i.pickAtScreen(b,!0);null!=c?(l!=c&&(null!=l&&l.OnMouseLeave(a),l=c,l.OnMouseEnter(a)),c.OnMouseMove(a)):(null!=l&&l.OnMouseLeave(a),l=null)}var i=this;Shape.call(this),this.Location=a?a:new Point3D(0,0,-1366),this.Size=b,this.SerializeAsSVG=function(a){var b=a;if(null!=b)for(var c=0;c<this.Shapes.length;c++){var d=this.Shapes[c].value.SerializeAsSVG();b.appendChild(d)}},this.BringToFront=function(a){var b=c(a);if(b>0&&b<this.Shapes.length-1){var d=this.Shapes[b];this.Shapes.splice(b,1),this.Shapes.splice(b+1,0,d)}},this.BringToFirst=function(a){var b=c(a);if(b>0&&b<this.Shapes.length-1){var d=this.Shapes[b];this.Shapes.splice(b,1),this.Shapes.splice(this.Shapes.length,0,d)}},this.SendToBack=function(a){var b=c(a);if(b>1){var d=this.Shapes[b];this.Shapes.splice(b,1),this.Shapes.splice(b-1,0,d)}},this.SendToLast=function(a){var b=c(a);if(b>1){var d=this.Shapes[b];this.Shapes.splice(b,1),this.Shapes.splice(0,0,d)}};var j=[];this.RemoveObject=function(a){j.push(a),this.Shapes=_.reject(this.Shapes,function(b){return b.value.Name==a.Name})};var k=null;this.Copy=function(a){k=a},this.Cut=function(a){k=a.Clone(),this.RemoveObject(a)},this.Paste=function(){var a=k.Clone();i.Add(a)};var l=null;this.OnSetParent=function(){if(null!=i.Parent){for(var a=0;a<i.Shapes.length;a++){var b=i.Shapes[a].value;b.SetParent(i.Parent)}i.Parent.AddSurfaceMouseDownEventListener(d),i.Parent.AddMouseUpEvent(e),i.Parent.AddTouchStartEvent(f),i.Parent.AddTouchEndEvent(g),i.Parent.AddMouseMoveEvent(h)}},this.LoadFromElement=function(a){if(Shape.prototype.LoadFromElement.call(this,a),null!=a){for(var b=0;b<a.attributes.length;b++){var c=a.attributes[b];switch(c.name){case"Size":var d=c.value.split(",");this.Size=new Size(parseInt(d[0]),parseInt(d[1]))}}for(var b=0;b<a.childNodes.length;b++){var e=a.childNodes[b];if(e.attributes){var f=Shape.prototype.From(e);null!=f&&void 0!=f&&this.Add(f)}}}},this.RemoveAll=function(){Shape.prototype.RemoveAll.call(this);for(var a=0;a<this.Shapes.length;a++)this.Shapes[a].value.Dispose();this.Shapes.splice(0,this.Shapes.length)},this.Dispose=function(){Shape.prototype.Dispose.call(this),this.RemoveAll(),this.Shapes=null}}function Shape2D(){Visual.call(this),this.MoveAlongWithCamara=!1,this.Origin=new Point(0,0),this.IsSelectable=!0,this.AlphaStroke=255,this.AlphaFill=255,this.Rotatable=!1,this.RotateAngle=0,this.RotatePoint=new Point(0,0),this.IsVisibleOnRunner=!0,this.Random=function(a){return Math.floor(Math.random()*a+1)},this.RandomFloat=function(a){return Math.random()*a+1}}function Image2D(a,b,c){Shape2D.call(this),this.Location=a,this.Size=b,this.ImageUrl=c;var d=this;if(void 0!=c){var e=new Image;d.Image=e,e.src=c}this.IsContains=function(a){var b=this.Container.GetImage2DProjectedPoints(this);return x1=b[0].x,x2=b[1].x,y1=b[0].y,y2=b[2].y,a.x>=x1&&a.x<=x2&&a.y>=y1&&a.y<=y2?!0:!1},this.MoveResize=function(a,b,c){switch(c){case 0:this.Location=new Point(this.Location.x-a,this.Location.y-b),this.Render();break;case 1:this.Size=new Size(this.Size.Width+a,this.Size.Height+b),this.Location=new Point(this.Location.x-a,this.Location.y-b),this.Render();break;case 2:this.Size=new Size(this.Size.Width-a,this.Size.Height+b),this.Location=new Point(this.Location.x,this.Location.y-b),this.Render();break;case 3:this.Size=new Size(this.Size.Width-a,this.Size.Height-b),this.Render();break;case 4:this.Size=new Size(this.Size.Width+a,this.Size.Height-b),this.Location=new Point(this.Location.x-a,this.Location.y),this.Render();break;case 5:this.Size=new Size(this.Size.Width+a,this.Size.Height),this.Location=new Point(this.Location.x-a,this.Location.y),this.Render();break;case 6:this.Size=new Size(this.Size.Width,this.Size.Height+b),this.Location=new Point(this.Location.x,this.Location.y-b),this.Render();break;case 7:this.Size=new Size(this.Size.Width-a,this.Size.Height),this.Render();break;case 8:this.Size=new Size(this.Size.Width,this.Size.Height-b),this.Render()}},this.Render=function(){Shape2D.prototype.Render.call(this),this.Parent.Refresh()},this.GetControlPoints=function(){var a=this.GetRelativePosition(new Point(this.Location.x,this.Location.y)),b=this.GetRelativePosition(new Point(this.Location.x+this.Size.Width,this.Location.y)),c=this.GetRelativePosition(new Point(this.Location.x+this.Size.Width,this.Location.y+this.Size.Height)),d=this.GetRelativePosition(new Point(this.Location.x,this.Location.y+this.Size.Height)),e=this.GetRelativePosition(new Point(this.Location.x,this.Location.y+this.Size.Height/2)),f=this.GetRelativePosition(new Point(this.Location.x+this.Size.Width/2,this.Location.y)),g=this.GetRelativePosition(new Point(this.Location.x+this.Size.Width,this.Location.y+this.Size.Height/2)),h=this.GetRelativePosition(new Point(this.Location.x+this.Size.Width/2,this.Location.y+this.Size.Height)),i=[a,b,c,d,e,f,g,h];return i},this.SerializeAsSVG=function(a){a||(a=document.createElement("image"));var b=a;return null!=b&&(b.setAttribute("x",this.Location.x),b.setAttribute("y",this.Location.y),b.setAttribute("width",this.Size.Width),b.setAttribute("height",this.Size.Height),$(b).attr("xlink:href",c)),b},this.LoadFromElement=function(a){if(Shape2D.prototype.LoadFromElement.call(this,a),null!=a)for(var b=0;b<a.attributes.length;b++){var c=a.attributes[b];switch(c.name){case"Size":var d=c.value.split(",");this.Size=new Size(parseInt(d[0]),parseInt(d[1]));break;case"Location":var d=c.value.split(",");this.Location=new Point(parseInt(d[0]),parseInt(d[1]));break;case"ImageUrl":this.ImageUrl=c.value;var e=new Image;this.Image=e,e.src=this.ImageUrl,e.onload=function(){};break;case"FillColor":var d=c.value.split(",");this.FillColor=new Color(parseInt(d[0]),parseInt(d[1]),parseInt(d[2]))}}}}function Label2D(a,b,c){Shape2D.call(this),this.Location=a,this.Size=b;var d=this;this.Text=c?c:"",this.IsContains=function(a){var b=this.Parent.GetProjectedPoint1(new Point3D(a.x,a.y,0)),c=this.Container.GetImage2DProjectedPoints(this);return x1=c[0].x,x2=c[1].x,y1=c[0].y,y2=c[2].y,b.x>=x1&&b.x<=x2&&b.y>=y1&&b.y<=y2?!0:!1},this.MoveResize=function(a,b,c){switch(c){case 0:this.Location=new Point(this.Location.x-a,this.Location.y-b),this.Render();break;case 1:this.Size=new Size(this.Size.Width+a,this.Size.Height+b),this.Location=new Point(this.Location.x-a,this.Location.y-b),this.Render();break;case 2:this.Size=new Size(this.Size.Width-a,this.Size.Height+b),this.Location=new Point(this.Location.x,this.Location.y-b),this.Render();break;case 3:this.Size=new Size(this.Size.Width-a,this.Size.Height-b),this.Render();break;case 4:this.Size=new Size(this.Size.Width+a,this.Size.Height-b),this.Location=new Point(this.Location.x-a,this.Location.y),this.Render();break;case 5:this.Size=new Size(this.Size.Width+a,this.Size.Height),this.Location=new Point(this.Location.x-a,this.Location.y),this.Render();break;case 6:this.Size=new Size(this.Size.Width,this.Size.Height+b),this.Location=new Point(this.Location.x,this.Location.y-b),this.Render();break;case 7:this.Size=new Size(this.Size.Width-a,this.Size.Height),this.Render();break;case 8:this.Size=new Size(this.Size.Width,this.Size.Height-b),this.Render()}},this.OnParentChange=function(a){null!=a&&a.onSetCamara(function(a,b){d.Location.x+=a,d.Location.y+=b})},this.Render=function(){Shape2D.prototype.Render.call(this),this.Parent.Refresh()},this.GetControlPoints=function(){var a=this.GetRelativePosition(new Point(this.Location.x,this.Location.y)),b=this.GetRelativePosition(new Point(this.Location.x+this.Size.Width,this.Location.y)),c=this.GetRelativePosition(new Point(this.Location.x+this.Size.Width,this.Location.y+this.Size.Height)),d=this.GetRelativePosition(new Point(this.Location.x,this.Location.y+this.Size.Height)),e=this.GetRelativePosition(new Point(this.Location.x,this.Location.y+this.Size.Height/2)),f=this.GetRelativePosition(new Point(this.Location.x+this.Size.Width/2,this.Location.y)),g=this.GetRelativePosition(new Point(this.Location.x+this.Size.Width,this.Location.y+this.Size.Height/2)),h=this.GetRelativePosition(new Point(this.Location.x+this.Size.Width/2,this.Location.y+this.Size.Height)),i=[a,b,c,d,e,f,g,h];return i},this.SerializeAsSVG=function(a){a||(a=document.createElement("image"));var b=a;return null!=b&&(b.setAttribute("x",this.Location.x),b.setAttribute("y",this.Location.y),b.setAttribute("width",this.Size.Width),b.setAttribute("height",this.Size.Height),$(b).attr("xlink:href",c)),b},this.LoadFromElement=function(a){if(Shape2D.prototype.LoadFromElement.call(this,a),null!=a)for(var b=0;b<a.attributes.length;b++){var c=a.attributes[b];switch(c.name){case"Size":var d=c.value.split(",");this.Size=new Size(parseInt(d[0]),parseInt(d[1]));break;case"FillColor":var d=c.value.split(",");this.FillColor=new Color(parseInt(d[0]),parseInt(d[1]),parseInt(d[2]));break;case"Location":var d=c.value.split(",");this.Location=new Point(parseInt(d[0]),parseInt(d[1]));break;case"Text":this.Text=c.value}}}}function Rectangle2D(a,b){Shape2D.call(this),this.Location=a,this.Size=b,this.SerializeAsSVG=function(a){return a||(a=document.createElement("rect")),element=Shape2D.prototype.SerializeAsSVG.call(this,a),null!=element&&(element.setAttribute("fill",this.FillColor.Value),element.setAttribute("x",this.Location.x),element.setAttribute("y",this.Location.y),element.setAttribute("width",this.Size.Width),element.setAttribute("height",this.Size.Height)),element},this.LoadFromElement=function(a){if(Shape2D.prototype.LoadFromElement.call(this,a),null!=a)for(var b=0;b<a.attributes.length;b++){var c=a.attributes[b];switch(c.name){case"Size":var d=c.value.split(",");this.Size=new Size(parseInt(d[0]),parseInt(d[1]));break;case"Location":var d=c.value.split(",");this.Location=new Point(parseInt(d[0]),parseInt(d[1]));break;case"FillColor":var d=c.value.split(",");this.FillColor=new Color(parseInt(d[0]),parseInt(d[1]),parseInt(d[2]))}}}}function Line2D(a,b,c){function d(a,b,c){var d=Math.PI/180*a,e=b.x+c*Math.cos(d),f=b.y+c*Math.sin(d);return new Point(e,f)}function e(a,b){var c=Math.atan2(b.y-a.y,b.x-a.x);return c*=180/Math.PI,c=0>c?360+c:c}function f(a,b,c){var f=e(a,b),g=f-90;g=0>g?360+g:g;var h=f+90;if(h%=360,0==c)return null;if(c%2==0){var i=d(g,a,c/2),j=d(h,a,c/2-1),k=d(g,b,c/2),l=d(h,b,c/2-1);return[i,k,l,j]}var i=d(g,a,c/2),j=d(h,a,c/2),k=d(g,b,c/2),l=d(h,b,c/2);return[i,k,l,j]}var g=this;Shape2D.call(this),this.Origin=a,this.Start=b,this.End=c;var h=function(a,b,c){var d=new Point(b.x,b.y),e=new Point(c.x,c.y),f=(a.y-d.y)*(e.x-d.x)-(a.x-d.x)*(e.y-d.y);if(Math.abs(f)>Number.EPSILON)return!1;var g=(a.x-d.x)*(e.x-d.x)+(a.y-d.y)*(e.y-d.y);if(0>g)return!1;var h=(e.x-d.x)*(e.x-d.x)+(e.y-d.y)*(e.y-d.y);return g>h?!1:!0},i=function(a,b){var c=b.y-a.y,d=a.x-b.x,e=c*a.x+d*a.y;return{A:c,B:d,C:e}},j=function(a,b,c){if(b>c){var d=b;b=c,c=d}return a>=b&&c>=a?!0:!1},k=function(a,b,c,d){var e,f,g,h,k,l,m=i(a,b);e=m.A,f=m.B,g=m.C;var n=i(c,d);h=n.A,k=n.B,l=n.C;var o=e*k-h*f;if(0==o)return!1;var p=(k*g-f*l)/o,q=(e*l-h*g)/o,r=j(p,a.x,b.x)&&j(q,a.y,b.y),s=j(p,c.x,d.x)&&j(q,c.y,d.y);return r&&s},l=function(a,b,c){return k(b,c,a,new Point(1e4,a.y))},m=function(a,b){for(var c=0,d=0;d<b.length;d++){var e=b[d],f=d==b.length-1?b[0]:b[d+1];if(h(a,e,f))return!0;l(a,e,f)&&c++}return c%2!=0};this.IsContains=function(a){var b=this.Container;if(null!=b){var c=f(g.RelativePoints[0],g.RelativePoints[1],this.BorderWidth),d=new Point3D(a.x,a.y,0),e=this.Parent.GetProjectedPoint1(d);return m(e,c)}return!1}}function Square2D(a,b){Shape2D.call(this),this.Location=a,this.Size=b,this.FillColor=new Color(255,255,255,255);var c=[];this.Create=function(){this.Created=!0},this.OnResize=function(){this.InvokeResizeEvent()},this.AddResizeEventHandler=function(a){c.push(a)},this.InvokeResizeEvent=function(){for(var a=0;a<c.length;a++)c[a]()},this.OnPaint=function(a){a.Graphics.DrawSquare2D(this)},this.Invalidate=function(){},this.GetInstance=function(){return new Square2D(this.Location,this.Size)},this.Clone=function(){var a=this.GetInstance();return this.Merge(a),a},this.IsContains=function(a){var b=this.Location.x,c=this.Location.x+this.Size,d=this.Location.y,e=this.Location.y+this.Size;return a.x>=b&&a.x<=c&&a.y>=d&&a.y<=e?!0:!1},this.MoveResize=function(a,b,c){switch(c){case 0:this.Location=new Point(this.Location.x-a,this.Location.y-b),this.Render();break;case 1:this.Size=this.Size+a,this.Location=new Point(this.Location.x-a,this.Location.y-a),this.Render();break;case 2:this.Size=this.Size-a,this.Location=new Point(this.Location.x,this.Location.y+a),this.Render();break;case 3:this.Size=this.Size-a,this.Render();break;case 4:this.Size=this.Size+a,this.Location=new Point(this.Location.x-a,this.Location.y),this.Render()}},this.GetClipRect=function(){},this.Render=function(){Shape2D.prototype.Render.call(this),this.Parent.Refresh()},this.GetControlPoints=function(){var a=this.GetRelativePosition(new Point(this.Location.x,this.Location.y)),b=this.GetRelativePosition(new Point(this.Location.x+this.Size,this.Location.y)),c=this.GetRelativePosition(new Point(this.Location.x+this.Size,this.Location.y+this.Size)),d=this.GetRelativePosition(new Point(this.Location.x,this.Location.y+this.Size)),e=[a,b,c,d];return e},this.Merge=function(a){Shape2D.prototype.Merge.call(this,a),a.FillColor=this.FillColor},this.SerializeAsSVG=function(a){return a||(a=document.createElement("rect")),element=Shape2D.prototype.SerializeAsSVG.call(this,a),null!=element&&(element.setAttribute("fill",this.FillColor.Value),element.setAttribute("x",this.Location.x),element.setAttribute("y",this.Location.y),element.setAttribute("width",this.Size),element.setAttribute("height",this.Size)),element}}function Circle2D(a,b){Shape2D.call(this);var c=this;this.Center=a,this.Radius=b,this.FillColor=new Color(255,255,255,255),this.DrawRect=void 0,this.GetClipRect=function(){return{Location:new Point(a.x-b,a.y-b),Size:new Size(2*b,2*b)}},this.Initialize=function(){var a=this.GetClipRect();this.Location=a.Location,this.Size=a.Size},this.Create=function(){c.Initialize(),Shape2D.prototype.Create.call(this)},this.GetControlPoints=function(){var a=this.GetRelativePosition(new Point(this.Center.x+this.Radius,this.Center.y)),b=[a];return b},this.OnPaint=function(a){a.Graphics.DrawCircle2D(this)},this.MoveResize=function(a,b,c){switch(c){case 0:this.Center=new Point(this.Center.x-a,this.Center.y-b),this.Render();break;case 1:this.Radius-=a,this.Render()}},this.Render=function(){Shape2D.prototype.Render.call(this),this.Parent.Refresh()},this.IsContains=function(a){var b=this.Container;if(null!=b){var c=b.GetCircleProjectedPoints(this),d=new Point3D(a.x,a.y,0),e=this.Parent.GetProjectedPoint1(d),f=c[0],g=c[1].x-c[0].x,h=e.x-f.x,i=e.y-f.y,j=h*h/(g*g)+i*i/(g*g);if(1>=j)return!0}return!1},this.Merge=function(a){Shape2D.prototype.Merge.call(this,a),a.FillColor=this.FillColor,a.Radius=this.Radius},this.Move=function(a){this.Center=a},this.NewInstance=function(){return new Circle2D},this.LoadFrom=function(){},this.SerializeTo=function(){},this.SerializeAsSVG=function(a){return a||(a=document.createElement("circle")),element=Shape2D.prototype.SerializeAsSVG.call(this,a),null!=element&&(element.setAttribute("fill",this.FillColor.Value),element.setAttribute("r",this.Radius),element.setAttribute("cx",this.Center.x),element.setAttribute("cy",this.Center.y)),element}}function Ellipse2D(a,b,c){Shape2D.call(this);var d=this;this.DrawRect=void 0,this.Center=a,this.RadiusX=b,this.RadiusY=c,this.FillColor=new Color(255,255,255,255),this.GetClipRect=function(){return{Location:new Point(a.x-this.RadiusX,a.y-this.RadiusY),Size:new Size(2*this.RadiusX,2*this.RadiusY)}},this.Initialize=function(){var a=this.GetClipRect();this.Location=a.Location,this.Size=a.Size},this.IsContains=function(a){var b=this.Container;if(null!=b){var c=b.GetEllipseProjectedPoints(this),d=new Point3D(a.x,a.y,0),e=this.Parent.GetProjectedPoint1(d),f=c[0],g=c[1].x-c[0].x,h=c[2].y-c[0].y,i=e.x-f.x,j=e.y-f.y,k=i*i/(g*g)+j*j/(h*h);if(1>=k)return!0}return!1},this.Create=function(){d.Initialize(),Shape2D.prototype.Create.call(this)},this.GetControlPoints=function(){var a=this.GetRelativePosition(new Point(this.Center.x+this.RadiusX,this.Center.y)),b=this.GetRelativePosition(new Point(this.Center.x,this.Center.y+this.RadiusY)),c=[a,b];return c},this.OnPaint=function(a){a.Graphics.DrawEllipse2D(this)},this.MoveResize=function(a,b,c){switch(c){case 0:this.Center=new Point(this.Center.x-a,this.Center.y-b),this.Render();break;case 1:this.RadiusX-=a,this.Render();break;case 2:this.RadiusY-=b,this.Render()}},this.Render=function(){Shape2D.prototype.Render.call(this),this.Parent.Refresh()},this.Merge=function(a){Shape2D.prototype.Merge.call(this,a),a.FillColor=this.FillColor,a.RadiusX=this.RadiusX,a.RadiusY=this.RadiusY},this.Move=function(a){this.Center=a},this.NewInstance=function(){return new Ellipse2D(this.Center,this.RadiusX,this.RadiusY)},this.LoadFrom=function(){},this.SerializeTo=function(){},this.SerializeAsSVG=function(a){return a||(a=document.createElement("ellipse")),element=Shape2D.prototype.SerializeAsSVG.call(this,a),null!=element&&(element.setAttribute("fill",this.FillColor.Value),element.setAttribute("cx",this.Center.x),element.setAttribute("cy",this.Center.y),element.setAttribute("rx",this.RadiusX),element.setAttribute("ry",this.RadiusY)),element}}function Polygon(a){Shape2D.call(this),this.Points=a||[],this.FillColor=new Color(255,255,255,255),this.RelativePoints=[],this.PointsCollection=void 0,this.Poit3DCollection=void 0;var b=function(a,b,c){var d=new Point(b.x,b.y),e=new Point(c.x,c.y),f=(a.y-d.y)*(e.x-d.x)-(a.x-d.x)*(e.y-d.y);if(Math.abs(f)>Number.EPSILON)return!1;var g=(a.x-d.x)*(e.x-d.x)+(a.y-d.y)*(e.y-d.y);if(0>g)return!1;var h=(e.x-d.x)*(e.x-d.x)+(e.y-d.y)*(e.y-d.y);return g>h?!1:!0},c=function(a,b){var c=b.y-a.y,d=a.x-b.x,e=c*a.x+d*a.y;return{A:c,B:d,C:e}},d=function(a,b,c){if(b>c){var d=b;b=c,c=d}return a>=b&&c>=a?!0:!1},e=function(a,b,e,f){var g,h,i,j,k,l,m=c(a,b);g=m.A,h=m.B,i=m.C;var n=c(e,f);j=n.A,k=n.B,l=n.C;var o=g*k-j*h;if(0==o)return!1;var p=(k*i-h*l)/o,q=(g*l-j*i)/o,r=d(p,a.x,b.x)&&d(q,a.y,b.y),s=d(p,e.x,f.x)&&d(q,e.y,f.y);return r&&s},f=function(a,b,c){return e(b,c,a,new Point(1e4,a.y))},g=function(a,c){for(var d=0,e=0;e<c.length;e++){var g=c[e],h=e==c.length-1?c[0]:c[e+1];if(b(a,g,h))return!0;f(a,g,h)&&d++}return d%2!=0};this.IsContains=function(a){var b=this.Container;if(null!=b){var c=b.GetPolygonProjectedPoints(this),d=new Point3D(a.x,a.y,0),e=this.Parent.GetProjectedPoint1(d);return g(e,c)}return!1},this.CalculateRelativePoints=function(){this.RelativePoints.splice(0,this.RelativePoints.length);for(var a=0;a<this.Points.length;a++)this.RelativePoints.push(this.GetRelativePosition(this.Points[a]))},this.GetClipRect=function(){for(var a=1e6,b=1e6,c=0,d=0,e=0;e<this.RelativePoints.length;e++)a>this.RelativePoints[e].x&&(a=this.RelativePoints[e].x),b>this.RelativePoints[e].y&&(b=this.RelativePoints[e].y),c<this.RelativePoints[e].x&&(c=this.RelativePoints[e].x),d<this.RelativePoints[e].y&&(d=this.RelativePoints[e].y);return{Location:new Point(a,b),Size:new Size(c-a,d-b)}},this.BuildRegularPolygon=function(){},this.CreateWindowsPoints=function(){for(var a=0;a<this.RelativePoints.length;a++){var b=this.RelativePoints[a];this.PointsCollection.push(new Point(b.x,b.y)),this.Poit3DCollection.push(new Point3D(b.x,b.y,0))}},this.AssignWindowsPoints=function(){for(var a=0;a<this.RelativePoints.length;a++){var b=this.RelativePoints[a];
this.PointsCollection[a]=new Point(b.x,b.y),this.Poit3DCollection[a]=new Point3D(b.x,b.y,0)}},this.GetControlPoints=function(){return this.Poit3DCollection},this.MoveResize=function(a,b,c){var d=c;if(d>0){this.PointsCollection[d-1]=new Point(this.PointsCollection[d-1].x-a,this.PointsCollection[d-1].y-b),this.Points[d-1]=new Point(this.Points[d-1].x-a,this.Points[d-1].y-b),this.RelativePoints[d-1]=this.GetRelativePosition(this.Points[d-1]);var e=this.PointsCollection[d-1];this.Poit3DCollection[d-1]=new Point3D(e.x,e.y,0)}else if(0==d)for(this.Origin=new Point(this.Origin.x-a,this.Origin.y-b),d=1;d<=this.PointsCollection.length;d++){this.PointsCollection[d-1]=new Point(this.PointsCollection[d-1].x-a,this.PointsCollection[d-1].y-b),this.RelativePoints[d-1]=this.GetRelativePosition(this.Points[d-1]);var e=this.PointsCollection[d-1];this.Poit3DCollection[d-1]=new Point3D(e.x,e.y,1)}this.Render()},this.Render=function(){Shape2D.prototype.Render.call(this),this.Parent.Refresh()},this.OnPaint=function(a){a.Graphics.DrawPolygon(this)},this.CanAddControlPoint=function(){return!0},this.CanInsertControlPoint=function(){return!0},this.InsertControlPoint=function(a){a=this.GetPoint(a);for(var b=this.Points[0],c=1;c<this.PointsCollection.length;c++){if(this.IsPointBetween(a,b,this.Points[c])){this.InsertPoint(a,c),this.Render();break}b=this.Points[c],c==this.PointsCollection.Count-1&&this.IsPointBetween(a,b,this.Points[0])&&(this.AddPoint(a),this.Render())}},this.AddControlPoint=function(a){a=this.GetPoint(a),this.AddPoint(a),this.Render()},this.GetPoint=function(a){return new Point(a.x-this.Origin.x,a.y-this.Origin.y)},this.InsertPoint=function(a,b){this.Points.splice(b,0,a),this.RelativePoints.splice(b,0,this.GetRelativePosition(a)),this.PointsCollection.splice(b,0,new Point(this.RelativePoints[b].x,this.RelativePoints[b].y)),this.Poit3DCollection.splice(b,0,new Point3D(this.RelativePoints[b].x,this.RelativePoints[b].y,0)),null!=this.ControlPointsHandler&&this.ControlPointsHandler.Refresh()},this.AddPoint=function(a){for(var b=0;b<this.Points.length;b++)if(a.Equals(this.Points[b]))return;this.Points.push(a),this.RelativePoints.push(this.GetRelativePosition(a)),this.PointsCollection.push(new Point(this.RelativePoints[this.Points.length-1].x,this.RelativePoints[this.Points.length-1].y)),this.Poit3DCollection.push(new Point3D(this.RelativePoints[this.Points.length-1].x,this.RelativePoints[this.Points.length-1].y,0)),null!=this.ControlPointsHandler&&this.ControlPointsHandler.Refresh()},this.IsPointBetween=function(a,b,c){var d,e,f,g,h=new Point(a.x,a.y),i=new Point(b.x,b.y),j=new Point(c.x,c.y);return i.x<=j.x?(d=i.x,e=j.x):(d=j.x,e=i.x),i.y<=j.y?(f=i.y,g=j.y):(f=j.y,g=i.y),h.x>=d&&h.x<=e&&h.y>=f&&h.y<=g?!0:!1},this.Merge=function(a){Shape2D.prototype.Merge.call(this,a),a.FillColor=this.FillColor,a.Points=this.Points},this.Move=function(a){this.Location=a,this.Origin=a,this.CalculateRelativePoints(),this.AssignWindowsPoints()},this.GetInstance=function(){return new Polygon},this.LoadFromElement=function(a){if(Shape2D.prototype.LoadFromElement.call(this,a),null!=a){for(var b=0;b<a.attributes.length;b++){var c=a.attributes[b];switch(c.name){case"Origin":var d=c.value.split(",");this.Origin=new Point(parseInt(d[0]),parseInt(d[1]));break;case"FillColor":var d=c.value.split(",");this.FillColor=new Color(parseInt(d[0]),parseInt(d[1]),parseInt(d[2]))}}for(var b=0;b<a.childNodes.length;b++){var e=a.childNodes[b];if(e.attributes)for(var f=0;f<e.attributes.length;f++){var c=e.attributes[f];switch(c.name){case"Point":var d=c.value.split(","),g=new Point(parseInt(d[0]),parseInt(d[1]));this.Points.push(g)}}}}},this.SerializeAsSVG=function(a){if(a||(a=document.createElement("polygon")),element=Shape2D.prototype.SerializeAsSVG.call(this,a),null!=element){element.setAttribute("fill",this.FillColor.Value);for(var b="",c=0;c<this.RelativePoints.length;c++)b+=this.RelativePoints[c].toString()+" ";b=b.substr(0,b.length-1),element.setAttribute("points",b)}return element}}function Polyline(a){Polygon.call(this,a),this.OnPaint=function(a){a.Graphics.DrawPolyline(this)},this.GetInstance=function(){return new Polyline},this.SerializeAsSVG=function(a){if(a||(a=document.createElement("path")),element=Shape2D.prototype.SerializeAsSVG.call(this,a),null!=element){element.setAttribute("fill",this.FillColor.Value);for(var b=this.RelativePoints,c="M"+b[0].x+" "+b[0].y+" ",d=1;d<b.length;d++)c+="L"+b[d].x+" "+b[d].y+" ";c=c.substr(0,c.length-1),element.setAttribute("d",c)}return element}}function MagneticSelection(a){Polyline.call(this,a),this.Create=function(){Polyline.prototype.Create.call(this)},this.Select=function(){Polyline.prototype.Select.call(this)},this.Deselect=function(){Polyline.prototype.Deselect.call(this)},this.Clone=function(){return new MagneticSelection(Points)},this.LineDash=!0}function PolylineCurved(a){Polyline.call(this,a),this.GetCurvePoints=function(a,b){for(var c=0;c<this.RelativePoints.length-3;c+=3)for(var d=this.RelativePoints[c],e=this.RelativePoints[c+1],f=this.RelativePoints[c+2],g=this.RelativePoints[c+3],h=0;1>h;h+=.1){var i=h,j=1-h,k=new Point(d.x*Math.pow(j,3)+3*e.x*Math.pow(j,2)*i+3*f.x*j*Math.pow(i,2)+g.x*Math.pow(i,2),d.y*Math.pow(j,3)+3*e.y*Math.pow(j,2)*i+3*f.y*j*Math.pow(i,2)+g.y*Math.pow(i,2));b.push(k)}for(var h=0;h<b.length;h++){var k=b[h];a.push(new Point(k.x,k.y))}},this.OnPaint=function(a){var b=[],c=[];this.GetCurvePoints(b,c),a.Graphics.DrawPolylineCurved(b,this)},this.NewInstance=function(){return new PolylineCurved},this.draw_bezier=function(a,b,c,d){for(var e=[],f=0;1>f;f+=.01){var g=f,h=1-f,i=new Point(a.x*Math.Pow(h,3)+3*b.x*Math.Pow(h,2)*g+3*c.x*h*Math.Pow(g,2)+d.x*Math.Pow(g,2),a.y*Math.Pow(h,3)+3*b.y*Math.Pow(h,2)*g+3*c.y*h*Math.Pow(g,2)+d.y*Math.Pow(g,2));e.Add(i)}for(var j=[],f=0;f<e.length;f++){var i=e[f];j.push(new Point(i.x,i.y))}return j},this.BuildRegularPolygon=function(){var a=[],b=[];this.GetCurvePoints(a,b)},this.CanInsertControlPoint=function(){return!1},this.AddControlPoint=function(a){a=this.GetPoint(a),this.AddPoint(a);for(var b=1;2>=b;b++)this.AddPoint(new Point(a.x+100*b,a.y+100*b));this.Render()},this.SerializeAsSVG=function(a){if(a||(a=document.createElement("path")),element=Shape2D.prototype.SerializeAsSVG.call(this,a),null!=element){element.setAttribute("fill",this.FillColor.Value);for(var b=this.RelativePoints,c="M"+b[0].x+" "+b[0].y+" ",d=1;d<b.length;d+=3)c+="C"+b[d].x+" "+b[d].y+" ",c+=b[d+1].x+" "+b[d+1].y+" ",c+=b[d+2].x+" "+b[d+2].y+" ";c=c.substr(0,c.length-1),element.setAttribute("d",c)}return element}}function PolyquadCurve(a){Polyline.call(this,a),this.GetCurvePoints=function(a,b){for(var c=0;c<this.RelativePoints.length-3;c+=3)for(var d=this.RelativePoints[c],e=this.RelativePoints[c+1],f=this.RelativePoints[c+2],g=this.RelativePoints[c+3],h=0;1>h;h+=.1){var i=h,j=1-h,k=new Point(d.x*Math.pow(j,3)+3*e.x*Math.pow(j,2)*i+3*f.x*j*Math.pow(i,2)+g.x*Math.pow(i,2),d.y*Math.pow(j,3)+3*e.y*Math.pow(j,2)*i+3*f.y*j*Math.pow(i,2)+g.y*Math.pow(i,2));b.push(k)}for(var h=0;h<b.length;h++){var k=b[h];a.push(new Point(k.x,k.y))}},this.OnPaint=function(a){a.Graphics.DrawPolyquadCurve(this)},this.NewInstance=function(){return new PolylineCurved},this.draw_bezier=function(a,b,c,d){for(var e=[],f=0;1>f;f+=.01){var g=f,h=1-f,i=new Point(a.x*Math.Pow(h,3)+3*b.x*Math.Pow(h,2)*g+3*c.x*h*Math.Pow(g,2)+d.x*Math.Pow(g,2),a.y*Math.Pow(h,3)+3*b.y*Math.Pow(h,2)*g+3*c.y*h*Math.Pow(g,2)+d.y*Math.Pow(g,2));e.Add(i)}for(var j=[],f=0;f<e.length;f++){var i=e[f];j.push(new Point(i.x,i.y))}return j},this.BuildRegularPolygon=function(){var a=[],b=[];this.GetCurvePoints(a,b)},this.CanInsertControlPoint=function(){return!1},this.AddControlPoint=function(a){a=this.GetPoint(a),this.AddPoint(a);for(var b=1;2>b;b++)this.AddPoint(new Point(a.x+100*b,a.y+100*b));this.Render()},this.SerializeAsSVG=function(a){if(a||(a=document.createElement("path")),element=Shape2D.prototype.SerializeAsSVG.call(this,a),null!=element){element.setAttribute("fill",this.FillColor.Value);for(var b=this.RelativePoints,c="M"+b[0].x+" "+b[0].y+" ",d=1;d<b.length;d+=2)c+="Q"+b[d].x+" "+b[d].y+" ",c+=b[d+1].x+" "+b[d+1].y+" ";c=c.substr(0,c.length-1),element.setAttribute("d",c)}return element}}function Size(a,b){this.Width=a,this.Height=b}function Color(a,b,c,d){function e(a){var b=a.toString(16);return 1==b.length?"0"+b:b}function f(a,b,c){return"#"+e(a)+e(b)+e(c)}this.r=a,this.g=b,this.b=c,this.a=d,this.Clone=function(){var a=new Color(this.r,this.g,this.b,this.a);return a},this.Value=f(a,b,c),this.FromHex=function(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);b&&(this.r=parseInt(b[1],16),this.g=parseInt(b[2],16),this.b=parseInt(b[3],16))},this.Equals=function(a){return this.r==a.r&&this.g==a.g&&this.b==a.b&&this.a==a.a?!0:!1}}function Graphics2D(a){this.ViewPort=a.ViewPort,this.DrawCircle=function(){},this.DrawPolygon=function(a){var b=a.Container;if(null!=b){var c=b.GetPolygonProjectedPoints(a);this.ViewPort.DrawPolygon(c,a)}},this.DrawPolyline=function(a){var b=a.Container;if(null!=b){var c=b.GetPolygonProjectedPoints(a);this.ViewPort.DrawPolyline(c,a)}},this.DrawPolylineCurved=function(a,b){var c=b.Container;if(null!=c){var d=c.GetPolygonProjectedPoints(b);this.ViewPort.DrawPolylineCurved(d,b)}},this.DrawPolyquadCurve=function(a){var b=a.Container;if(null!=b){var c=b.GetPolygonProjectedPoints(a);this.ViewPort.DrawPolyquadCurve(c,a)}}}function Graphics3D(a){this.ViewPort=a,this.DrawBackgroundImage=function(a){this.ViewPort.DrawBackgroundImage(a)},this.Clear=function(a){this.ViewPort.Clear(a)},this.DrawLine3D=function(a){var b=a.ProjectedPoints;this.ViewPort.DrawLine(b[0],b[1],a.Color,a.width)},this.DrawSurface2D=function(){},this.Update=function(){this.ViewPort.Update()}}function Point3D(a,b,c){this.x=a,this.y=b,this.z=c}function Point(a,b){this.x=a,this.y=b,this.toString=function(){return this.x+","+this.y}}function Angle3D(a,b,c){this.x=a,this.y=b,this.z=c}function Paint3DEventListener(a){this.Paint=a}function PaintInitEventListener(a){this.InitPaint=a}function Paint2DEventArgs(a){this.Graphics=a}function Paint3DEventArgs(a){this.Graphics=a}function KeyPressEventListener(a){this.KeyPress=a}function KeyEventArgs(a){this.Key=a.keyCode,this.evt=a}function MouseEventArgs(a,b,c,d){this.actual=a,this.button=b,this.x=c,this.y=d}function Game(){var a=new EventHandler(this);a.createEvent("levelInit"),a.createEvent("levelLoaded"),this.onLoadXml=function(b){a.raiseEvent("levelInit",b)},this.onLevelLoaded=function(b){a.raiseEvent("levelLoaded",b)}}function Controller(a){this.Geoport=a,this.Loader=new Loader}function Loader(){var a=this;this.Name="",this.LifeImage=null,this.ScoreImage=null,this.Lives=0,this.Score=0,this.FontImages=[],this.FrontPages=[],this.Levels=[],this.EndPage=null,this.GameOverPage=null,this.RemoveAll=function(){a.LifeImage=null,a.ScoreImage=null,a.FontImages.splice(0,a.FontImages.length),a.FrontPages.splice(0,a.FrontPages.length),a.Levels.splice(0,a.Levels.length),a.EndPage=null,a.GameOverPage=null},this.LoadFrom=function(b){a.RemoveAll();var c=b.documentElement;if(null!=c){for(var d=0;d<c.attributes.length;d++){var e=c.attributes[d];switch(e.name){case"name":var f=e.value;a.Name=f;break;case"lives":var f=e.value;a.Lives=parseInt(f)}}for(var d=0;d<c.childNodes.length;d++){var g=c.childNodes[d];if(g.attributes)for(var h=0;h<g.attributes.length;h++){var e=g.attributes[h];if(e)switch(e.value){case"lifeimage":var i=g.getAttribute("ref");a.LifeImage=_utility.GetVisual2D(i);break;case"scoreimage":var i=g.getAttribute("ref");a.ScoreImage=_utility.GetVisual2D(i);break;case"char":var j=g.getAttribute("value"),i=g.getAttribute("ref"),k=_utility.GetVisual2D(i);a.FontImages.Add(Convert.ToChar(j),k);break;case"frontpage":var i=g.getAttribute("ref");a.FrontPages.push(i);break;case"level":var i=g.getAttribute("ref");a.Levels.push(i);break;case"endpage":var i=g.getAttribute("ref");a.EndPage=i;break;case"gameover":var i=g.getAttribute("ref");a.GameOverPage=i}}}}}}function SingleShapeVisual(){Shape2D.call(this)}function ControlPointsHandler(a){this.Points=a}function ControlPointsHandler2D(a){ControlPointsHandler.call(this,a)}function AlphaChannel(a,b,c,d,e,f,g,h){SingleShapeVisual.call(this),this.Name=a,this.Color=b,this.BorderWidth=c,this.Location=d,this.VisualSource=e,this.Size=f,this.Interval=g,this.OnAlphaEnd=h}function MultiShapeVisual(){Shape2D.call(this);var a=this;this.VisualSources=null,this.getShapesCount=function(){return a._shapes.Count},this._repeaterShapes=[],this._shapes=[],this.AddShapes=function(){this.FillList(a._shapes,a.VisualSources);for(var b=0;b<a._shapes.length;b++){var c=a._shapes[b],d=c.Clone();d.Create(),d.Parent=a.Parent,d.Container=a.Container,a._repeaterShapes.push(d)}},this.OnSetContainer=function(){for(var b=0;b<a._shapes.length;b++)a._shapes[b].Container=this.Container,a._repeaterShapes[b].Container=this.Container},this.GetLocation=function(a,b){return new Point(a.x-b.x,a.y-b.y)},this.Create=function(){Shape2D.prototype.Create.call(this)},this.Dispose=function(){Shape2D.prototype.Dispose.call(this);for(var b=0;b<a._repeaterShapes.length;b++)a._repeaterShapes[b].Dispose()},this.MoveResize=function(b,c,d){switch(d){case 1:case 0:a.Location=new Point(a.Location.x-b,a.Location.y-c),a.Render()}},this.Render=function(){Shape2D.prototype.Render.call(this),a.Parent.RePaint()},this.GetOriginalShape=function(b){return a._shapes.length>b?a._shapes[b]:null},this.GetShape=function(b){return a._shapes.length>b?a._repeaterShapes[b]:null},this.GetControlPoints=function(){var b=new Point3D(a.Location.x,a.Location.y,0),c=[b];return c},this.Add=function(b){(""==b.Name||null==b.Name)&&(b.Name=b.GetType().Name+Environment.TickCount),b.Parent=this.Parent,b.Container=this.Container,b.CanRemove=!1;var c=b.Clone();c.Parent=this.Parent,c.Container=this.Container,c.Create(),a._repeaterShapes.Add(c),a._shapes.Add(b)},this.Move=function(b){a.Location=b,this.onMove()},this.onMove=function(){},this.Merge=function(b){Shape2D.prototype.Merge.call(this,b),b._repeaterShapes=a._repeaterShapes,b._shapes=a._shapes}}function ComplexShape(a){MultiShapeVisual.call(this);var b=this;this.Location=a||new Point(0,0),this.OnPaint=function(a){for(var c=0;c<b._shapes.length;c++){var d=b._repeaterShapes[c],e=b._shapes[c];e.Merge(d),d.Move(Polygon.prototype.isPrototypeOf(d)?new Point(this.Location.x+e.Origin.x,this.Location.y+e.Origin.y):new Point(this.Location.x+e.Location.x,this.Location.y+e.Location.y)),d.OnPaint(a)}},this.GetInstance=function(){return new ComplexShape(b.Location)},this.GetClipRect=function(){for(var a=1e6,c=1e6,d=0,e=0,f=0;f<b._shapes.length;f++)a>b._shapes[f].Location.x&&(a=b._shapes[f].Location.x),c>b._shapes[f].Location.y&&(c=b._shapes[f].Location.y),d<b._shapes[f].Location.x+b._shapes[f].Size.width&&(d=b._shapes[f].Location.x+b._shapes[f].Size.width),e<b._shapes[f].Location.y+b._shapes[f].Size.height&&(e=b._shapes[f].Location.y+b._shapes[f].Size.height);return originalShapeLocation=new Point(a,c),new Rectangle(this.Location,new Size(d-a,e-c))}}function Animator(){function a(){if("Design"!=f.VisualMode&&!f.Stopped){if(f.AutoDestroy&&new Date>=f.AutoDestroyTime)return f.Container.Remove(this),f.Dispose(),void f.Parent.Refresh();"Manual"==f.AnimationMode?f.CheckKeypress():-1==f.RepeatCount&&f.AutoMove(),f.count++,f.count>=f.Interval&&("Automatic"==f.AnimationMode&&(-1==f.RepeatCount||i<f.RepeatCount)?(f.AssignShapeIndex0(),e==f._repeaterShapes.length-1&&i++,f.Parent.Refresh(),f.count=0):0!=g&&(f.AssignShapeIndex0(),f.Parent.Refresh(),f.count=0)),f.count>1e3&&(f.count=0)}}MultiShapeVisual.call(this);var b,c,d=[0,1],e=0,f=this,g=0,h=-1,i=0,j=null;f.Interval=100,f.VisualMode="Design",f.AnimationMode="Manual",f.RepeatCount=-1,f.Location=location,f.count=0,f.AnimateOnMouseDown=!1,f.AutoDestroyTime=null,f.AutoDestroy=!1,f.Stopped=!1,f.SetFrameOrder=function(a){if(""!=a&&null!=a){d.splice(0,d.length);for(var b=a,c=b.Split(","),e=0;e<c.length;e++){var f=c[e];d.push(parseInt(f))}}},f.GetFrameOrder=function(){for(var a="",b=0;b<d.length;b++){var c=d[b];a+=c+","}return a.endsWith(",")&&(a=a.splice(a.Length-1,1)),a},this.Pause=function(){f.Stopped=!0},this.Play=function(){f.Stopped=!1},this.OnParentChangeInvoke=function(a){MultiShapeVisual.prototype.OnParentChangeInvoke.call(this,a),f.Parent!=a&&null!=f.Parent},this.handleAnimatorMouseDown=function(){this.AnimateOnMouseDown&&"Run"==this.VisualMode&&(i=0,f.RepeatCount=1,f.count=f.Interval)},this.handleAnimatorTouchStart=function(a){f.handleAnimatorMouseDown(a)};var k;this.OnParentChange=function(b){MultiShapeVisual.prototype.OnParentChange.call(this,b),null!=b&&(k=f.Parent.AddPaintInitEventListener(a))},this.AutoMove=function(){},this.CheckKeypress=function(){},this.onMove=function(){window[this.OnMoveLabel]&&window[this.OnMoveLabel]({sender:this})},this.AssignShapeIndex0=function(){g++,g>=d.length&&(g=0,this.OnAnimationEnd()),e=d[g],1==g&&this.OnAnimationStart()},this.AssignShapeIndex2=function(a,b){a!=c&&(c=a,h=-1),h++,h>=b.length&&(h=0),e=b[h]},this.OnPaint=function(a){var b=f._repeaterShapes[e],c=f._shapes[e];c.Merge(b),b.Move(this.Location),b.OnPaint(a),f.Size=b.Size,j=b},this.IsContains=function(a){return null!=j?j.IsContains(a):void 0},this.Dispose=function(){MultiShapeVisual.prototype.Dispose.call(this),f.Parent.RemovePaintInitEventListener(k)},this.OnDestroy=function(){this.OnDestroyLabel&&(window[this.OnDestroyLabel]&&window[this.OnDestroyLabel]({sender:this}),this.OnDestroyLabel=void 0)},this.OnDestroying=function(){this.OnDestroyingLabel&&(window[this.OnDestroyingLabel]&&window[this.OnDestroyingLabel]({sender:this}),this.OnDestroyingLabel=void 0)},this.OnAnimationStart=function(){this.OnStartLabel&&window[this.OnStartLabel]&&window[this.OnStartLabel]({sender:this})},this.OnAnimationEnd=function(){this.OnEndLabel&&window[this.OnEndLabel]&&window[this.OnEndLabel]({sender:this})},this.GetClipRect=function(){for(var a=1e6,c=1e6,d=0,e=0,g=0;g<f._shapes.length;g++)a>f._shapes[g].Location.x&&(a=f._shapes[g].Location.x),c>f._shapes[g].Location.y&&(c=f._shapes[g].Location.y),d<f._shapes[g].Location.x+f._shapes[g].Size.width&&(d=f._shapes[g].Location.x+f._shapes[g].Size.width),e<f._shapes[g].Location.y+f._shapes[g].Size.height&&(e=f._shapes[g].Location.y+f._shapes[g].Size.height);return b=new Point(a,c),new Rectangle(this.Location,new Size(d-a,e-c))}}function Repeater(a){SingleShapeVisual.call(this);var b=this;this.Orientation="Horizantal",this.RepeatCount=10,this.Rows=5,this.Columns=5,this.Spacing=0,this.Location=a?a:new Point(0,0),this.OnPaint=function(a){for(var c=b.RepeaterShape,d=b.Shape,e=0;e<b.Rows;e++)for(var f=0;f<b.Columns;f++){d.Merge(c);var g=this.Location.x+f*(c.Size.Width+b.Spacing),h=this.Location.y+e*(c.Size.Height+b.Spacing);c.Move(new Point(g,h)),c.Location.x+c.Size.Width>this.Container.Parent.ClipRectLocation.x&&c.Location.x<this.Parent.ClipRectLocation.x+this.Container.Size.Width&&c.Location.y+c.Size.Height>this.Parent.ClipRectLocation.y&&c.Location.y<this.Parent.ClipRectLocation.y+this.Container.Size.Height&&(b.Rotatable&&(c.Rotatable=!0,c.RotateAngle=b.RotateAngle,c.RotatePoint=b.RotatePoint),c.OnPaint(a))}b.Size.Width=(c.Size.Width+b.Spacing)*b.Columns-b.Spacing,b.Size.Height=(c.Size.Height+b.Spacing)*b.Rows-b.Spacing},this.GetClipRect=function(){return 0==b.Size.Width&&0==b.Size.Height?{Location:b.Location,Size:new Size(10,10)}:{Location:b.Location,Size:b.Size}},this.LoadFromElement=function(a){if(SingleShapeVisual.prototype.LoadFromElement.call(this,a),null!=a)for(var c=0;c<a.attributes.length;c++){var d=a.attributes[c];switch(d.name){case"RepeatCount":b.RepeatCount=parseInt(d.value);break;case"Spacing":b.Spacing=parseInt(d.value);break;case"Rows":b.Rows=parseInt(d.value);break;case"Columns":b.Columns=parseInt(d.value);break;case"Orientation":b.Orientation=d.value}}}}function RandomRepeater(a,b){function c(){if(d.Created){d._randomPoints.splice(0,d._randomPoints.length);for(var a=0;a<d.RepeatCount;a++)_randomPoints.push(new Point(d.Random(d.Size.Width),d.Random(d.Size.Height)))}}var d=this;SingleShapeVisual.call(this),d.Location=a?a:new Point(0,0),d.Size=b?b:new Size(100,100),d.RepeatCount=10,d._randomPoints=[],this.setSize=function(a){(d.Size.Width!=a.Width||d.Size.Height!=a.Height)&&(d.Size=a,c())},this.setRepeatCount=function(a){d.Repeatcount=a,OnRepeatCountChange()},this.OnRepeatCountChange=function(){if(d.Created){d._randomPoints.splice(0,d._randomPoints.length);for(var a=0;a<d.RepeatCount;a++)d._randomPoints.push(new Point(d.Random(d.Size.Width),d.Random(Size.Height)))}},this.Create=function(){SingleShapeVisual.prototype.Create.call(this),0==d._randomPoints.length&&d.OnRepeatCountChange()},this.OnPaint=function(a){for(var b=0;b<d.RepeatCount;b++){var c=d.RepeaterShape,e=d.Shape;b>0?c.Move(new Point(_randomPoints[b].x+Location.x,_randomPoints[b].y+Location.y)):(e.Merge(c),c.Move(this.Location)),c.OnPaint(a)}},this.GetClipRect=function(){return{Location:Location,Size:Size}}}function SpriteVisual(a,b){function c(){if("Design"!=e.VisualMode){var a=new Date;if(a.getTime()>=f.getTime()){for(var b=0;b<e.RepeatCount;b++)i&&d(b),e._randomPoints[b]=new Point(e._randomPoints[b].x+h[b],e._randomPoints[b].y+g[b]),(e._randomPoints[b].y>e.Size.Height||e._randomPoints[b].x>e.Size.Width||e._randomPoints[b].x<0)&&d(b);i=!1,e.Parent.Refresh(),f.setMilliseconds(a.getMilliseconds()+e.Interval)}}}function d(a){var b=e.RandomFloat(e.WindMax)+e.WindMin;h.length<=a?h.push(b):h[a]=b;var c=e.RandomFloat(e.SpeedMax)+e.SpeedMin;g.length<=a?g.push(c):g[a]=c,e._randomPoints[a]=new Point(e.Random(e.Size.Width),0)}var e=this;RandomRepeater.call(this,a,b),this.Interval=500;var f=new Date;this.SpeedMax=2,this.SpeedMin=5,this.WindMax=10,this.WindMin=0;var g=[],h=[];this.OnParentChange=function(a){RandomRepeater.prototype.OnParentChange.call(this,a),null!=a&&e.Parent.AddPaintInitEventListener(c)},this.OnPaint=function(a){for(var b=0;b<this.RepeatCount;b++){var c=this.RepeaterShape,d=this.Shape;0==b&&d.Merge(c),c.Move(new Point(e._randomPoints[b].x+this.Location.x,e._randomPoints[b].y+this.Location.y)),c.OnPaint(a)}};var i=!0;this.LoadFromElement=function(a){if(SingleShapeVisual.prototype.LoadFromElement.call(this,a),null!=a)for(var b=0;b<a.attributes.length;b++){var c=a.attributes[b];switch(c.name){case"SpeedMax":e.SpeedMax=parseInt(c.value);break;case"Spacing":e.SpeedMin=parseInt(c.value);break;case"Interval":e.Interval=parseInt(c.value);break;case"WindMax":e.WindMax=parseInt(c.value);break;case"WindMin":e.WindMin=parseInt(c.value)}}}}function WalkableAnimator(){function a(a,b){if(a.splice(0,a.length),""!=b&&null!=b)for(var c=b,d=c.split(","),e=0;e<d.length;e++){var f=d[e];a.push(parseInt(f))}}function b(a){for(var b="",c=0;c<a.length;c++){var d=a[c];b+=d+","}return b.endsWith(",")&&(b=b.remove(b.Length-1,1)),b}function c(){q.Location.y+q.Size.Height+q.FallingSpeed+200<q.Parent.ClipRectLocation.y+q.Container.Size.Height?g(0,q.FallingSpeed,"Space",u,!1):f(0,q.FallingSpeed,"Space",u)}function d(){switch(q.MoveDirection){case"Left":var a=-q.Speed;q.Location.x+a>q.Parent.ClipRectLocation.x+1e3?g(a,0,"Left",u,!1):f(a,0,"Left",u);break;case"Right":var a=q.Speed;q.Location.x+q.Size.Width+a<q.Parent.ClipRectLocation.x+q.Container.Size.Width-1e3?g(a,0,"Right",t,!1):f(a,0,"Right",t)}}function e(a,b){a.Name="",a.AutoDestroy=!0,b.MapSourceDirection&&(a.MoveDirection=this.MoveDirection);var c=new Date;c.setMilliseconds(c.getMilliseconds()+b.LifeTime),a.AutoDestroyTime=c,Container.Add(a),a._parent_LoadedFromFile(null,null),a.Move(this.Location),a.VisualMode="Run"}function f(a,b,c,d){return g(a,b,c,d,!0)}function g(a,b,c,d,e){var f={},g=i(new Point(q.Location.x+a,q.Location.y+b),f),j=(f.touchType,f.visual2d);if("None"!=g){if("Obstacles"==g){var k=j;null!=k&&h()}return!1}return e&&q.Parent.SetCamera(a,b),q.Move(new Point(q.Location.x+a,q.Location.y+b)),q.count>=q.Interval&&(q.AssignShapeIndex2(c,d),q.count=0),q.Parent.Refresh(),!0}function h(){p=!0}function i(a,b){for(var c=0;c<x.length;c++){var d=x[c];if(b.touchType=j(a,d),"None"!=b.touchType)return b.visual2d=d,"WalkableSurfaces"}for(var c=0;c<y.length;c++){var d=y[c];if(b.touchType=j(a,d),"None"!=b.touchType)return b.visual2d=d,"Feeds"}for(var c=0;c<B.length;c++){var d=B[c];if(b.touchType=j(a,d),"None"!=b.touchType)return b.visual2d=d,"Obstacles"}for(var c=0;c<z.length;c++){var d=z[c];if(b.touchType=j(a,d),"None"!=b.touchType)return b.visual2d=d,"Resources"}return b.touchType="None",b.visual2d=null,"None"}function j(a,b){var c=new Point(q.Location.x+q.Size.Width-q.SizeAdjustmentIndex,q.Location.y+q.Size.Height-q.SizeAdjustmentIndex),d=new Point(q.Location.x,q.Location.y+q.Size.Height-q.SizeAdjustmentIndex),e=b.IsContains(d),f=b.IsContains(c);if(f&&e)return"Top";if(f)return"Left";if(e)return"Right";var g=new Point(q.Location.x+q.Size.Width/2,q.Location.y+q.Size.Height-q.SizeAdjustmentIndex),h=b.IsContains(g);if(h)return"Top";var i=new Point(q.Location.x+q.Size.Width-q.SizeAdjustmentIndex,q.Location.y+q.SizeAdjustmentIndex),j=new Point(q.Location.x,q.Location.y+q.SizeAdjustmentIndex),k=b.IsContains(j),l=b.IsContains(i);if(l&&k)return"Bottom";if(l)return"Left";if(k)return"Right";var m=new Point(q.Location.x+q.Size.Width/2,q.Location.y+q.SizeAdjustmentIndex),n=b.IsContains(m);return n?"Bottom":"None"}Animator.call(this);var k,l,m,n,o,p,q=this,r=[0,1],s=[0,1],t=[0,1],u=[0,1],v=[0,1],w=[0,1],x=[],y=[],z=[],A=[],B=[],C=!1,D=0,E=!1,F=0,G=0,H=20,I=40,J=20,K=40,L=new Date,M=!0;this.Fallable=!1,this.Speed=10,this.Size=new Size(0,0),this.MoveDirection="Right",this.SizeAdjustmentIndex=0,this.EnableMultipleJump=0,this.UpSpeed=15,this.FallingSpeed=15,this.EnableAutoMoveRight=!1,this.setJumpHeight=function(a){H=a,I=2*a,J=H,K=I},this.getWalkableSurfaces=function(){return k},this.setWalkableSurfaces=function(a){k=a,FillList(x,a)},this.getFeeds=function(){return l},this.setFeeds=function(a){l=a,FillList(y,a)},this.getResources=function(){return n},this.setResources=function(a){n=a,FillList(z,a)},this.getActiveResources=function(){return o},this.setActiveResources=function(a){o=a,FillList(A,a)},this.getObstacles=function(){return m},this.setObstacles=function(a){m=a,FillList(B,a)},this.getUpKeyFrames=function(){return b(r)},this.setUpKeyFrames=function(b){a(r,b)},this.getDownKeyFrames=function(){return b(s)},this.setDownKeyFrames=function(b){a(s,b)},this.getRightKeyFrames=function(){return b(t)},this.setRightKeyFrames=function(b){a(t,b)},this.getLeftKeyFrames=function(){return b(u)},this.setLeftKeyFrames=function(b){a(u,b)},this.getSpaceKeyFrames=function(){return b(w)},this.setSpaceKeyFrames=function(b){a(w,b)},this.getDestroyFrames=function(){return b(v)},this.setDestroyFrames=function(b){a(v,b)},this.CheckKeypress=function(){if(Keyboard.isSpaceKeyDown&&q.EnableMultipleJump&&(D=0),p)return void(100>G?(0==G&&q.OnDestroying(),q.count>=q.Interval&&(q.AssignShapeIndex2("Delete",v),q.count=0),q.Parent.Refresh(),G++):q.OnDestroy());if(C){if(J>D){var a=-q.UpSpeed,b=!1;b=q.Location.y+a>q.Parent.ClipRectLocation.y+200?g(0,a,"Space",u,!1):f(0,a,"Space",u)}else c();D++,D==K&&(C=!1,J=H,K=I)}else q.Fallable&&c();if(Keyboard.isSpaceKeyDown&&(C||E||(C=!0,D=0,E=!0)),Keyboard.isSpaceKeyDown||(E=!1),Keyboard.isRightKeyDown||q.EnableAutoMoveRight?(q.MoveDirection="Right",d()):Keyboard.isLeftKeyDown?(q.MoveDirection="Left",d()):Keyboard.isUpKeyDown||Keyboard.isDownKeyDown,A.length>0){var h=A[F];if(null!=h)if("OnKeyPress"==h.CreateAnimatorMode){if(Keyboard.isKeyDown(h.Key)){var i=h.Animator.Clone();null!=i&&M&&(e(i,h),M=!1)}Keyboard.isKeyDown(h.Key)||(M=!0)}else if((new Date).getTime()>=L){var i=h.Animator.Clone();null!=i&&(e(i,h),L.setMilliseconds(L.getMilliseconds()+h.Interval))}}},this.LoadFromElement=function(a){if(Animator.prototype.LoadFromElement.call(this,a),null!=a)for(var b=0;b<a.attributes.length;b++){var c=a.attributes[b];switch(c.name){case"WalkableSurfaces":k=c.value;break;case"Feeds":l=c.value;break;case"Resources":n=c.value;break;case"Speed":q.Speed=parseInt(c.value);break;case"ActiveResources":o=c.value;break;case"Obstacles":m=c.value;break;case"UpKeyFrames":q.setUpKeyFrames(c.value);break;case"DownKeyFrames":q.setDownKeyFrames(c.value);break;case"RightKeyFrames":q.setRightKeyFrames(c.value);break;case"LeftKeyFrames":q.setLeftKeyFrames(c.value);break;case"SpaceKeyFrames":q.setSpaceKeyFrames(c.value);break;case"Fallable":q.Fallable="True"===c.value;break;case"MoveDirection":q.MoveDirection=c.value;break;case"EnableMultipleJump":q.EnableMultipleJump="True"===c.value;break;case"SizeAdjustmentIndex":q.SizeAdjustmentIndex=parseInt(c.value);break;case"UpSpeed":q.UpSpeed=parseInt(c.value);break;case"FallingSpeed":q.FallingSpeed=parseInt(c.value);break;case"JumpHeight":q.setJumpHeight(parseInt(c.value));break;case"EnableAutoMoveRight":q.EnableAutoMoveRight="True"===c.value}}},this.Parent_LoadedFromFile=function(){Animator.prototype.Parent_LoadedFromFile.call(this),this.FillList(x,k),this.FillList(y,l),this.FillList(B,m),this.FillList(z,n),this.FillList(A,o)},this.NewInstance=function(){return new WalkableAnimator},q.setLocation=function(a,b){var c=a.x-q.Location.x,d=a.y-q.Location.y;q.Move(a),b&&q.Parent.SetCamera(c,d)}}function Player(){this.Init=function(){var a=new Game;a.Initiate('{"Name":"Fighter","Lives":3, "FrontPages":[0],"Levels":[1],"EndPage":2,"GameOverPage":3}')}}function Box3D(a,b){Shape.call(this),this.x=a,this.y=b}function Blinker(a){SingleShapeVisual.call(this),this.Location=a}function Cursor(a){Blinker.call(this,a)}function ContainerControl(a,b){Rectangle2D.call(this,a,b),this.Shapes=[],this.RepeaterShapes=[]}function WebPage(a,b){ContainerControl.call(this,a,b)}function ImageBackground(a,b){ContainerControl.call(this,a,b),this.SerializeAsSVG=function(a){return a||(a=document.createElement("rect")),element=Shape2D.prototype.SerializeAsSVG.call(this,a),null!=element&&(element.setAttribute("width",this.Size.Width),element.setAttribute("height",this.Size.Height),element.setAttribute("fill",this.FillColor.Value)),element}}function Header(a,b){ContainerControl.call(this,a,b)}function Navigation(a,b){ContainerControl.call(this,a,b)}function RightPane(a,b){ContainerControl.call(this,a,b)}function LeftPane(a,b){ContainerControl.call(this,a,b)}function ContentPane(a,b){ContainerControl.call(this,a,b)}function TopPane(a,b){ContainerControl.call(this,a,b)}function BottomPane(a,b){ContainerControl.call(this,a,b)}function Footer(a,b){ContainerControl.call(this,a,b)}function Panel(a,b){ContainerControl.call(this,a,b)}function RichTextBox(a,b){function c(){m.Cursor.Location=new Point(0,30*(w-1))}function d(a){var b=m.GetPosition(a);return b.x=b.x-m.Location.x,b.y=b.y-m.Location.y,b}function e(a){var b=Math.floor(a.y/u),c=0;if(b<q.length)for(var d=0;d<q[b].length;d++){var e=q[b].charAt(d),f=c+o[e].width;if(!(f<a.x))break;c=f}return w>b?new Point(c,30*b):null}function f(a){for(var b=0;b<t[a].spans.length;b++)if(r.col>=t[a].spans[b].start&&r.col<=t[a].spans[b].end)return b;return-1}function g(a){for(var b=0;b<t[a].spans.length;b++)if(s.col>=t[a].spans[b].start&&s.col<=t[a].spans[b].end)return b;return-1}function h(a){if(void 0===o[a]){var b=m.Parent.ViewPort.DrawingContext.measureText(a);o[a]=b}}function i(a){void 0!==t[a]&&t[a].spans[0].end++}function j(a){void 0!==t[a]&&t[a].spans[0].end--}function k(a,b){var c=a,d=0,e=0;if(c<q.length)for(var f=0;f<q[c].length;f++){var g=q[c].charAt(f),h=e+o[g].width;if(!(b>h))break;e=h,d=f}return{width:e,index:d}}function l(a,b){var c=a.x,d=b.x,e=a.y,f=b.y;a.x>b.x&&(c=b.x,d=a.x),a.y>b.y&&(e=b.y,f=a.y);var g=Math.floor(e/u),h=Math.floor(f/u);z={};for(var i=g;h>=i;i++){if(i===g&&i===h){var j=k(i,c),l=k(i,d);r={line:i,col:j.index},s={line:i,col:l.index}}else if(i===g){var j=k(i,c),l=k(i,m.Size.Width);r={line:i,col:j.index}}else if(i===h){var j=k(i,0),l=k(i,d);s={line:i,col:l.index}}else var j=k(i,0),l=k(i,m.Size.Width);z[i]={Start:new Point(j.width,30*i),End:new Point(l.width,30*i)}}}ContainerControl.call(this,a,b);var m=this,n=null,o={},p="",q=[""];m.Lines=q;var r=null,s=null,t=[{spans:[{start:0,end:0,color:"rgb(0,0,0)"}]}];
m.Lines1=t;var u=30,v=1,w=1;this.EditMode=!0;var x=null,y=!1,z={};this.Create=function(){ContainerControl.prototype.Create.call(this),n=new Cursor(new Point(0,0)),n.SetParent(this.Parent),n.SetContainer(this.Container),n.Origin=this.GetRelativePosition(this.Location),n.Create(),this.Cursor=n,this.Created=!0},this.ChageSelection=function(){for(var a=r.line,b=s.line,c=a;b>=c;c++)if(c===a&&c===b){var d=f(c),e=g(c),h=e-d;if(0===h){var i=t[c].spans[d],j={start:i.start,end:r.col},k={start:r.col,end:s.col},l={start:s.col,end:i.end};t[c].spans[d]=j,t[c].spans.splice(d+1,0,k),t[c].spans.splice(d+2,0,l)}else if(1===h){var i=t[c].spans[d],m=t[c].spans[e],j={start:i.start,end:r.col},k={start:r.col,end:s.col},l={start:s.col,end:m.end};t[c].spans[d]=j,t[c].spans[e]=l,t[c].spans.splice(d+1,0,k)}else if(h>1){var i=t[c].spans[d],m=t[c].spans[e],j={start:i.start,end:r.col},k={start:r.col,end:s.col},l={start:s.col,end:m.end};t[c].spans.splice(d,h+1),t[c].spans.splice(d,0,j),t[c].spans.splice(d+1,0,k),t[c].spans.splice(d+2,0,l)}}else if(c===a){var d=f(c),i=t[c].spans[d],j={start:i.start,end:r.col},k={start:r.col,end:q[c].length-1};t[c].spans[d]=j,t[c].spans.splice(d+1,0,k),t[c].spans.splice(d+2,t[c].spans.length-(d+2))}else if(c===b){var e=g(c),i=t[c].spans[e],k={start:0,end:s.col},l={start:s.col,end:i.end};t[c].spans[e]=l,t[c].spans.splice(0,e),t[c].spans.splice(0,0,k)}else{var k={start:0,end:q[c].length-1};t[c].spans.splice(0,t[c].spans.length),t[c].spans.push(k)}},this.OnMouseDown=function(a){var b=d(a);z={},r=null,s=null,x=b;var f=e(b);null!==f?m.Cursor.Location=f:c(),y=!0,m.Parent.Refresh()},this.KeyPress=function(a){if(32==a.keyCode)q[q.length-1]+=" ",i(q.length-1),h(" ",a),m.Parent.Refresh();else if(a.keyCode>=48&&a.keyCode<=90){var b=String.fromCharCode(a.keyCode);b=a.shiftKey?b:b.toLowerCase(),q[q.length-1]+=b,i(q.length-1),h(b,a),m.Parent.Refresh()}else 8==a.keyCode?q[q.length-1].length>0?(q[q.length-1]=q[q.length-1].slice(0,-1),j(q.length-1),m.Parent.Refresh()):(q.splice(q.length-1,1),t.splice(q.length-1,1)):13==a.keyCode&&(q.push(""),t.push({spans:[{start:0,end:0,color:"rgb(0,0,0)"}]}),w++,m.Parent.Refresh())},this.OnPaint=function(a){ContainerControl.prototype.OnPaint.call(this,a),m.Text=p,m.LineHeight=u,a.Graphics.DrawText(m),m.Cursor.OnPaint(a)},this.OnMouseMove=function(a){if(y){var b=d(a);l(x,b),m.Parent.Refresh()}},this.OnMouseUp=function(){y=!1},this.Merge=function(a){Rectangle2D.prototype.Merge.call(this,a),a.Lines=q,a.Lines1=t,a.SelectionCoordinates=z,a.LineHeight=u,a.LineIndex=v,a.Cursor=n}}window.Keyboard=new function(){var a=this;a.isLeftKeyDown=!1,a.isSpaceKeyDown=!1,a.isRightKeyDown=!1,a.isUpKeyDown=!1,a.isDownKeyDown=!1,a.isCtrlKeyDown=!1;var b=[];a.keyDown=function(a){b.push(a)},a.isKeyDown=function(){return!1},window.onkeydown=function(c){for(var d=0;d<b.length;d++)b[d](c);switch(c.keyCode){case 32:a.isSpaceKeyDown=!0;break;case 39:a.isRightKeyDown=!0;break;case 37:a.isLeftKeyDown=!0;break;case 17:a.isCtrlKeyDown=!0}},window.onkeyup=function(b){switch(b.keyCode){case 32:a.isSpaceKeyDown=!1;break;case 39:a.isRightKeyDown=!1;break;case 37:a.isLeftKeyDown=!1;break;case 17:a.isCtrlKeyDown=!1}}},Geoport.prototype.Shapes=[],Geoport.prototype.ViewPort=null,Geoport.prototype.LookDirection=null,Geoport.prototype.CameraPosition=null,Geoport.prototype.Listeners=null,Geoport.prototype.KeyPressEventListeners=null,Geoport.prototype.PaintInitEventListeners=null,Geoport.prototype.SurfaceMouseDownEventHandlers=null,Geoport.prototype.SurfaceMouseMoveEventHandlers=null,Geoport.prototype.SurfaceMouseUpEventHandlers=null,Geoport.prototype.SurfaceTouchStartEventHandlers=[],Geoport.prototype.SurfaceTouchEndEventHandlers=[],Geoport.prototype.LoadedEventListeners=[],Geoport.prototype.GeoportCommandListeners=[],Geoport.prototype.Div=null,Geoport.prototype.background=null,Geoport.prototype.Invalidated=!0,Geoport.prototype.Canvas=null,Geoport.prototype.Anchors=[],Geoport.prototype.ConrolPoints=[],Geoport.prototype.ClipRectLocation=null,Geoport.prototype.DisableInvalidateOnPaint=!0,Geoport.prototype.OnMouseDown=function(a){var b=this.GetRelativeArgs(a);this.InvokeSurfaceMouseDownEvent(b),this.Refresh()},Geoport.prototype.OnTouchStart=function(a){var b=this.GetTouchArgs(a);this.InvokeTouchStartEvent(b),this.Refresh()},Geoport.prototype.OnTouchEnd=function(a){var b=this.GetTouchArgs(a);this.InvokeTouchEndEvent(b),this.Refresh()},Geoport.prototype.OnMouseMove=function(a){var b=this.GetRelativeArgs(a);this.InvokeSurfaceMouseMoveEvent(b),this.Refresh()},Geoport.prototype.OnMouseUp=function(a){var b=this.GetRelativeArgs(a);this.InvokeSurfaceMouseUpEvent(b),this.Refresh()},Geoport.prototype.GetTouchArgs=function(a){var b=a.touches.length>0?a.touches[0].clientX:0,c=a.touches.length>0?a.touches[0].clientY:0,d=new MouseEventArgs(a,a.button,b+this.CameraPosition.x,c+this.CameraPosition.y);return d},Geoport.prototype.GetRelativeArgs=function(a){var b=new MouseEventArgs(a,a.button,a.x+this.CameraPosition.x,a.y+this.CameraPosition.y);return b},Geoport.prototype.Load=function(a,b){this.RemoveAll(),this.background=a,this.Canvas.setAttribute("style","background-color:rgb("+a.r+","+a.g+","+a.b+")");for(var c=0;c<b.length;c++)this.AddShape(b[c]);this.InvokeLoadedEvent()},Geoport.prototype.AddSurfaceMouseDownEventListener=function(a){this.SurfaceMouseDownEventHandlers.push(a)},Geoport.prototype.AddMouseMoveEvent=function(a){this.SurfaceMouseMoveEventHandlers.push(a)},Geoport.prototype.AddMouseUpEvent=function(a){this.SurfaceMouseUpEventHandlers.push(a)},Geoport.prototype.AddTouchStartEvent=function(a){this.SurfaceTouchStartEventHandlers.push(a)},Geoport.prototype.AddTouchEndEvent=function(a){this.SurfaceTouchEndEventHandlers.push(a)},Geoport.prototype.InvokeTouchStartEvent=function(a){for(var b=0;b<this.SurfaceTouchStartEventHandlers.length;b++)this.SurfaceTouchStartEventHandlers[b](a)},Geoport.prototype.InvokeTouchEndEvent=function(a){for(var b=0;b<this.SurfaceTouchEndEventHandlers.length;b++)this.SurfaceTouchEndEventHandlers[b](a)},Geoport.prototype.InvokeSurfaceMouseDownEvent=function(a){for(var b=0;b<this.SurfaceMouseDownEventHandlers.length;b++)this.SurfaceMouseDownEventHandlers[b](a)},Geoport.prototype.InvokeSurfaceMouseMoveEvent=function(a){for(var b=0;b<this.SurfaceMouseMoveEventHandlers.length;b++)this.SurfaceMouseMoveEventHandlers[b](a)},Geoport.prototype.InvokeSurfaceMouseUpEvent=function(a){for(var b=0;b<this.SurfaceMouseUpEventHandlers.length;b++)this.SurfaceMouseUpEventHandlers[b](a)},Geoport.prototype.AddLoadedEventListener=function(a){return this.LoadedEventListeners.push(a),a},Geoport.prototype.removeLoadedEventListener=function(a){for(var b=0;b<this.LoadedEventListeners.length;b++)if(this.LoadedEventListeners[b]===a){this.LoadedEventListeners.splice(b,1);break}},Geoport.prototype.RemovePaintInitEventListener=function(a){for(var b=0;b<this.PaintInitEventListeners.length;b++)if(this.PaintInitEventListeners[b]===a){this.PaintInitEventListeners.splice(b,1);break}},Geoport.prototype.Dispose=function(){this.RemoveAll(),this.Shapes=null,this.ViewPort=null,this.LookDirection=null,this.CameraPosition=null,this.Listeners=null,this.KeyPressEventListeners=null,this.PaintInitEventListeners=null,this.SurfaceMouseDownEventHandlers=null,this.SurfaceMouseMoveEventHandlers=null,this.SurfaceMouseUpEventHandlers=null,this.LoadedEventListeners=null,this.GeoportCommandListeners=null,this.Div=null,this.background=null,this.Invalidated=null,this.Canvas=null,this.Anchors=null,this.ConrolPoints=null,this.ClipRectLocation=null,this.DisableInvalidateOnPaint=null},Geoport.prototype.RemoveAll=function(){for(var a=0;a<this.Shapes.length;a++)this.Shapes[a].value.Dispose();this.Listeners.splice(0,this.Listeners.length),this.KeyPressEventListeners.splice(0,this.KeyPressEventListeners.length),this.PaintInitEventListeners.splice(0,this.PaintInitEventListeners.length),this.SurfaceMouseDownEventHandlers.splice(0,this.SurfaceMouseDownEventHandlers.length),this.SurfaceMouseMoveEventHandlers.splice(0,this.SurfaceMouseMoveEventHandlers.length),this.SurfaceMouseUpEventHandlers.splice(0,this.SurfaceMouseUpEventHandlers.length),this.SurfaceTouchEndEventHandlers.splice(0,this.SurfaceTouchEndEventHandlers.length),this.SurfaceTouchStartEventHandlers.splice(0,this.SurfaceTouchStartEventHandlers.length),this.Anchors.splice(0,this.Anchors.length),this.ConrolPoints.splice(0,this.ConrolPoints.length),this.Shapes.splice(0,this.Shapes.length)},Geoport.prototype.removeEventHandler=function(a,b){this.eventHandler.removeEvent(a,b)},Geoport.prototype.Refresh=function(){this.Invalidated=!0},Geoport.prototype.OnKeyPress=function(a){this.InvokeKeyPressEvent(a)},Geoport.prototype.InvokePaintInitEvent=function(){for(var a=0;a<this.PaintInitEventListeners.length;a++)this.PaintInitEventListeners[a]()},Geoport.prototype.InvokeLoadedEvent=function(a){for(var b=0;b<this.LoadedEventListeners.length;b++)this.LoadedEventListeners[b](a)},Geoport.prototype.AddPaintInitEventListener=function(a){return this.PaintInitEventListeners.push(a),a},Geoport.prototype.InvokeKeyPressEvent=function(a){for(var b=0;b<this.KeyPressEventListeners.length;b++)this.KeyPressEventListeners[b].KeyPress(a)},Geoport.prototype.AddKeyPressEventListener=function(a){this.KeyPressEventListeners.push(a)},Geoport.prototype.viewport_Paint=function(a){this.InvokePaintInitEvent(),this.Invalidated&&(this.OnPaint(a),this.DisableInvalidateOnPaint?this.Invalidated=!1:this.DisableInvalidateOnPaint=!0)},Geoport.prototype.paint=function(){null!=this.ViewPort.Graphics&&this.OnPaint(new Paint3DEventArgs(_viewPort.Graphics))},Geoport.prototype.OnPaint=function(a){this.BackgroundImage?a.Graphics.DrawBackgroundImage(this.BackgroundImage):a.Graphics.Clear(this.background),this.InvokePaintEvent(a),a.Graphics.Update()},Geoport.prototype.AddPaint3DEventListener=function(a){this.Listeners.push(a)},Geoport.prototype.InvokePaintEvent=function(a){for(var b=0;b<this.Listeners.length;b++)this.Listeners[b].Paint(a)},Geoport.prototype.Invalidate=function(){},Geoport.prototype.GetProjectedPoint1=function(a){return this.GetProjectedPoint(a,this.CameraPosition,this.LookDirection,new Angle3D(0,0,0))},Geoport.prototype.AddShape=function(a){if(null==a.Name||""==a.Name){var b=new Date,c=b.getTime();a.Name="line3d"+c}a.SetParent(this),this.Shapes.push({key:a.Name,value:a}),a.Create()},Geoport.prototype.AddAnchor=function(a){this.Shapes.length>0&&this.Shapes[0].value.Add(a)},Geoport.prototype.GetProjectedPoint=function(a,b,c,d){var e=Math.cos(d.y),f=Math.cos(d.x),g=Math.cos(d.z),h=Math.sin(d.y),i=Math.sin(d.x),j=Math.sin(d.z),k=a.x-b.x,l=a.y-b.y,m=a.z-b.z,n=e*(j*l+g*k)-h*m,o=i*(e*m+h*(j*l+g*k))+f*(g*l-j*k),p=f*(e*m+h*(j*l+g*k))-i*(g*l-j*k),q=new Point(0,0);if(0!=p){var r=(n-c.x)*(c.z/p),s=(o-c.y)*(c.z/p);q=new Point(r,s)}return q},Geoport.prototype.initiate=function(){this.ViewPort.CreateSdlWindow()},Geoport.prototype.DrawSurface=function(){return ViewPort},Geoport.prototype.ExecuteCommand=function(a){null!=a&&(this.InvokeGeoportCommand(a),this.DisableInvalidateOnPaint=!1)},Geoport.prototype.InvokeGeoportCommand=function(a){for(var b=0;b<this.GeoportCommandListeners.length;b++)this.GeoportCommandListeners[b](a)},Geoport.prototype.AddGeoportCommandListener=function(a){this.GeoportCommandListeners.push(a)},Geoport.prototype.AddAnchorMesh=function(a,b,c){this.Anchors.push({key:b,value:a}),this.ConrolPoints.push({key:b,value:c})},Geoport.prototype.RemoveAnchors=function(){if(this.Shapes.length>0)for(var a=0;a<this.Anchors.length;a++)this.Shapes[0].value.Remove(this.Anchors[a].key);this.Anchors.splice(0,this.Anchors.length),this.ConrolPoints.splice(0,this.ConrolPoints.length)},Geoport.prototype.GetAnchor=function(a){for(var b=0;b<this.Anchors.length;b++)if(this.Anchors[b].key==a)return this.Anchors[b].key;return null},Geoport.prototype.GetControlPoint=function(a){for(var b=0;b<this.ConrolPoints.length;b++)if(this.ConrolPoints[b].key==a)return this.ConrolPoints[b].value;return ControlPoint.None},Geoport.prototype.GetShape2D=function(a){for(var b=0;b<this.Anchors.length;b++)if(this.Anchors[b].key==a)return this.Anchors[b].value;return null},GeoportDesigner.prototype=Object.create(Geoport.prototype),GeoportDesigner.prototype.OnMouseDown=function(a){Geoport.prototype.OnMouseDown.call(this,a);var b=this.GetRelativeArgs(a);this.geoport_MouseDown(b)},GeoportDesigner.prototype.OnMouseUp=function(a){Geoport.prototype.OnMouseUp.call(this,a);var b=this.GetRelativeArgs(a);this.geoport_MouseUp(b)},GeoportDesigner.prototype.OnMouseMove=function(a){Geoport.prototype.OnMouseMove.call(this,a);var b=this.GetRelativeArgs(a);this.geoport_MouseMove(b)},ViewPort.prototype.Canvas=null,ViewPort.prototype.Graphics=null,ViewPort.prototype.Listeners=null,ViewPort.prototype.KeyPressEventListeners=null,ViewPort.prototype.SurfaceMouseDownEventHandlers=null,ViewPort.prototype.SurfaceMouseMoveEventHandlers=null,ViewPort.prototype.SurfaceMouseUpEventHandlers=null,ViewPort.prototype.TouchStartEventHandlers=null,ViewPort.prototype.TouchEndEventHandlers=null,ViewPort.prototype.Width=null,ViewPort.prototype.Height=null,ViewPort.prototype.DrawingContext=null,ViewPort.prototype.OnKeyPress=function(a){var b=new KeyEventArgs(a);this.InvokeKeyPressEvent(b)},ViewPort.prototype.Refresh=function(){this.Invalidate()},ViewPort.prototype.Invalidate=function(){this.OnPaint(new Paint3DEventArgs(this.Graphics))},ViewPort.prototype.AddKeyPressEventListener=function(a){this.KeyPressEventListeners.push(a)},ViewPort.prototype.AddSurfaceMouseDownEventListener=function(a){this.SurfaceMouseDownEventHandlers.push(a)},ViewPort.prototype.AddTouchStartEventListener=function(a){this.TouchStartEventHandlers.push(a)},ViewPort.prototype.InvokeTouchStartEvent=function(a){for(var b=0;b<this.TouchStartEventHandlers.length;b++)this.TouchStartEventHandlers[b](a)},ViewPort.prototype.InvokeTouchEndEvent=function(a){for(var b=0;b<this.TouchEndEventHandlers.length;b++)this.TouchEndEventHandlers[b](a)},ViewPort.prototype.AddTouchEndEventListener=function(a){this.TouchEndEventHandlers.push(a)},ViewPort.prototype.AddSurfaceMouseMoveEventListener=function(a){this.SurfaceMouseMoveEventHandlers.push(a)},ViewPort.prototype.AddSurfaceMouseUpEventListener=function(a){this.SurfaceMouseUpEventHandlers.push(a)},ViewPort.prototype.AddPaint3DEventListener=function(a){this.Listeners.push(a)},ViewPort.prototype.InvokePaintEvent=function(a){for(var b=0;b<this.Listeners.length;b++)this.Listeners[b].Paint(a)},ViewPort.prototype.InvokeKeyPressEvent=function(a){for(var b=0;b<this.KeyPressEventListeners.length;b++)this.KeyPressEventListeners[b].KeyPress(a)},ViewPort.prototype.InvokeSurfaceMouseDownEvent=function(a){for(var b=0;b<this.SurfaceMouseDownEventHandlers.length;b++)this.SurfaceMouseDownEventHandlers[b](a)},ViewPort.prototype.InvokeSurfaceMouseMoveEvent=function(a){for(var b=0;b<this.SurfaceMouseMoveEventHandlers.length;b++)this.SurfaceMouseMoveEventHandlers[b](a)},ViewPort.prototype.InvokeSurfaceMouseUpEvent=function(a){for(var b=0;b<this.SurfaceMouseUpEventHandlers.length;b++)this.SurfaceMouseUpEventHandlers[b](a)},ViewPort.prototype.GetColorStyle=function(a){var b=a.r.toString(),c=a.g.toString(),d=a.b.toString(),e="rgb("+b+","+c+","+d+")";return e},ViewPort.prototype.DrawLine=function(a,b,c){var d=this.GetColorStyle(c.Color);this.DrawingContext.strokeStyle=d,this.DrawingContext.lineWidth=c.BorderWidth,this.DrawingContext.beginPath(),this.DrawingContext.moveTo(a.x,a.y),this.DrawingContext.lineTo(b.x,b.y),c.BorderWidth>0&&(this.DrawingContext.globalAlpha=c.AlphaStroke/255,this.DrawingContext.stroke(),this.DrawingContext.globalAlpha=1),this.DrawingContext.closePath()},ViewPort.prototype.Update=function(){},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),ViewPort.prototype.PaintEventArgs=null,ViewPort.prototype.CreateSdlWindow=function(){this.Graphics=new Graphics3D(this),this.PaintEventArgs=new Paint3DEventArgs(this.Graphics),this.Render()},ViewPort.prototype.OnPaint=function(a){this.InvokePaintEvent(a)},ViewPort.prototype.Render=function(){var a=this;this.OnPaint(a.PaintEventArgs),requestAnimFrame(function(){a.Render()})},ViewPort.prototype.DrawEllipse=function(a,b,c,d){var e=this.GetColorStyle(d.Color);this.DrawingContext.strokeStyle=e,this.DrawingContext.lineWidth=d.BorderWidth,this.DrawingContext.fillStyle=this.GetColorStyle(d.FillColor),this.DrawingContext.beginPath();for(var f=a.x,g=a.y,h=0*Math.PI;h<2*Math.PI;h+=.01){var i=f-c*Math.sin(h)*Math.sin(0*Math.PI)+b*Math.cos(h)*Math.cos(0*Math.PI),j=g+b*Math.cos(h)*Math.sin(0*Math.PI)+c*Math.sin(h)*Math.cos(0*Math.PI);0==h?this.DrawingContext.moveTo(i,j):this.DrawingContext.lineTo(i,j)}this.DrawingContext.globalAlpha=d.AlphaFill/255,this.DrawingContext.fill(),d.BorderWidth>0&&(this.DrawingContext.globalAlpha=d.AlphaStroke/255,this.DrawingContext.stroke()),this.DrawingContext.closePath(),this.DrawingContext.globalAlpha=1},ViewPort.prototype.DrawCircle=function(a,b,c){var d=this.GetColorStyle(c.Color);this.DrawingContext.strokeStyle=d,this.DrawingContext.lineWidth=c.BorderWidth,this.DrawingContext.fillStyle=this.GetColorStyle(c.FillColor),this.DrawingContext.beginPath(),this.DrawingContext.arc(a.x,a.y,b,0,2*Math.PI,!1),this.DrawingContext.globalAlpha=c.AlphaFill/255,this.DrawingContext.fill(),c.BorderWidth>0&&(this.DrawingContext.globalAlpha=c.AlphaStroke/255,this.DrawingContext.stroke()),this.DrawingContext.globalAlpha=1},ViewPort.prototype.DrawSquare=function(a,b,c,d){var e=this.GetColorStyle(d.Color);this.DrawingContext.strokeStyle=e,this.DrawingContext.lineWidth=d.BorderWidth,this.DrawingContext.fillStyle=this.GetColorStyle(d.FillColor),this.DrawingContext.globalAlpha=d.AlphaFill/255,this.DrawingContext.fillRect(a.x,a.y,b,c),d.BorderWidth>0&&(this.DrawingContext.globalAlpha=d.AlphaStroke/255,this.DrawingContext.strokeRect(a.x,a.y,b,c)),this.DrawingContext.globalAlpha=1},ViewPort.prototype.DrawText=function(a,b,c,d){var e=(d.Text,d.Lines),f=d.Lines1;for(var g in d.SelectionCoordinates){var h=d.SelectionCoordinates[g].Start,i=d.SelectionCoordinates[g].End,j=h.x,k=i.x,l=h.y,m=i.y;h.x>i.x&&(j=i.x,k=h.x),h.y>i.y&&(l=i.y,m=h.y),l=Math.floor(m/d.LineHeight),l=d.LineHeight*l+14,this.DrawRectangle("",new Point(a.x+j,a.y+l),k-j,16,new Color(100,100,100),new Color(0,255,0),1)}for(var n=0;n<e.length;n++){var o=a.y+d.LineHeight*(n+1),p=a.x;if(f.length>0)for(var q=0;q<f[n].spans.length;q++){var r=f[n].spans[q];this.DrawingContext.fillStyle=r.color,this.DrawingContext.font="16px Verdana";var s=e[n].substring(r.start,r.end);this.DrawingContext.fillText(s,p,o),p+=this.DrawingContext.measureText(s).width}}},ViewPort.prototype.DrawImage2D=function(a,b,c,d,e,f,g){var h=this.DrawingContext;h.globalAlpha=g.AlphaFill/255,h.save(),g.Rotatable&&(h.translate(g.RotatePointProjected.x,g.RotatePointProjected.y),h.rotate(g.RotateAngle*(Math.PI/180)),a.x=a.x-g.RotatePointProjected.x,a.y=a.y-g.RotatePointProjected.y),this.DrawRectangle(a,b,c,g),g.FlipH?(h.scale(-1,1),h.drawImage(g.Image,-(a.x+b),a.y,b,c)):g.FlipV?(h.scale(1,-1),h.drawImage(g.Image,a.x,-(a.y+c),b,c)):h.drawImage(g.Image,a.x,a.y,b,c),h.restore(),h.globalAlpha=1},ViewPort.prototype.DrawLabel2D=function(a,b,c,d){var e=b/d.Size.Width,f=32*e;this.DrawRectangle(a,b,c,d),this.DrawingContext.fillStyle=this.GetColorStyle(d.Color),this.DrawingContext.font=f+"px jing jing";for(var g=d.Text,h=g.split("\n"),i=a.y,j=0;j<h.length;j++)this.DrawingContext.fillText(h[j],a.x,i+f),i+=f},Visual.prototype.MouseDownCommand="None",Visual.prototype.IsMouseHovered=!1,Visual.prototype.Name="",Visual.prototype.Created=!1,Visual.prototype.VisualMode="Run",Visual.prototype.Dragmode=!1,Visual.prototype.Parent=null,Visual.prototype.EventHandler=null,Visual.prototype.SetParent=function(a){this.OnParentChangeInvoke(a),this.Parent=a,this.OnParentChange(a),this.OnSetParent()},Visual.prototype.OnSetParent=function(){if(null!=this.Parent){var a=this;this.loadedEvent=this.Parent.AddLoadedEventListener(function(){a.Parent_LoadedFromFile()})}},Visual.prototype.Parent_LoadedFromFile=function(){},Visual.prototype.OnParentChange=function(){},Visual.prototype.OnParentChangeInvoke=function(){},Visual.prototype.OnMouseMove=function(){},Visual.prototype.OnDragEnter=function(){},Visual.prototype.OnDragDrop=function(){},Visual.prototype.OnMouseEnter=function(a){this.IsMouseHovered=!0,this.mouseEnter(a)},Visual.prototype.OnMouseLeave=function(a){this.IsMouseHovered=!1,this.mouseLeave(a)},Visual.prototype.OnTouchEnd=function(a){this.IsMouseHovered=!1,this.touchEnd(a)},Visual.prototype.OnTouchStart=function(a){this.IsMouseHovered=!0,this.touchStart(a)},Visual.prototype.OnMouseUp=function(a){this.handleMouseUp(a)},Visual.prototype.OnMouseDown=function(a){this.handleMouseDown(a)},Visual.prototype.LoadFromElement=function(a){if(null!=a)for(var b=0;b<a.attributes.length;b++){var c=a.attributes[b];switch(c.name){case"MouseDownCommand":this.MouseDownCommand=c.value;break;case"MouseUpCommand":this.MouseUpCommand=c.value;break;case"OnMouseDown":this.OnMouseDownLabel=c.value;break;case"OnMouseUp":this.OnMouseUpLabel=c.value;break;case"OnMouseEnter":this.OnMouseEnterLabel=c.value;break;case"OnMouseLeave":this.OnMouseLeaveLabel=c.value;break;case"OnTouchStart":this.OnTouchStartLabel=c.value;break;case"OnTouchEnd":this.OnTouchEndLabel=c.value}}},Visual.prototype.RemoveAll=function(){},Visual.prototype.Dispose=function(){this.Parent.removeLoadedEventListener(this.loadedEvent),this.EventHandler.ClearEvent("mouseDown"),this.EventHandler.ClearEvent("mouseUp"),this.EventHandler.ClearEvent("touchStart"),this.EventHandler.ClearEvent("touchEnd"),this.MouseDownCommand=null,this.IsMouseHovered=null,this.Name="",this.Created=null,this.VisualMode=null,this.Dragmode=null},Shape.prototype.Name=null,Shape.prototype.Parent=null,Shape.prototype.BorderWidth=1,Shape.prototype.Created=!1,Shape.prototype.ProjectedPoints=null,Shape.prototype.Color=null,Shape.prototype.SetParent=function(a){this.Parent=a,this.OnSetParent()},Shape.prototype.OnSetParent=function(){},Shape.prototype.Update=function(){},Shape.prototype.Create=function(){var a=this;null!=this.Parent&&this.Parent.AddPaint3DEventListener(new Paint3DEventListener(function(b){a.Parent_Paint(b)})),this.Created=!0},Shape.prototype.Parent_Paint=function(a){this.OnPaint(a)},Shape.prototype.OnPaint=function(){},Shape.prototype.GetProjectedPoints=function(){return null},Shape.prototype.Invalidate=function(){},Shape.prototype.From=function(a){for(var b=a,c=0;c<b.attributes.length;c++){var d=b.attributes[c];switch(d.name){case"Type":try{var e=d.value.split("."),f=e[e.length-1],g=new window[f];return g.LoadFromElement(a),g}catch(h){return console.log(h),null}}}return null},Shape.prototype.LoadFromElement=function(a){if(null!=a)for(var b=0;b<a.attributes.length;b++){var c=a.attributes[b];switch(c.name){case"Name":this.Name=c.value}}},Shape.prototype.RemoveAll=function(){Visual.prototype.RemoveAll.call(this)},Shape.prototype.Dispose=function(){Visual.prototype.Dispose.call(this),this.Name=null,this.Parent=null,this.BorderWidth=null,this.Created=!1,this.ProjectedPoints.splice(0,this.ProjectedPoints.length),this.Color=null},Line3D.prototype=Object.create(Shape.prototype),Line3D.prototype.base=null,Line3D.prototype.x=null,Line3D.prototype.y=null,Line3D.prototype.width=1,Line3D.prototype.OnPaint=function(a){Shape.prototype.OnPaint.call(this,a),this.ProjectedPoints=this.GetProjectedPoints(),a.Graphics.DrawLine3D(this)},Line3D.prototype.Invalidate=function(){},Line3D.prototype.Create=function(){Shape.prototype.Create.call(this)},Line3D.prototype.GetProjectedPoints=function(){var a=this.Parent.GetProjectedPoint1(this.x),b=this.Parent.GetProjectedPoint1(this.y);return new Array(a,b)},Line3D.prototype.GetInstance=function(){return new Line3D},Surface2D.prototype=Object.create(Shape.prototype),Surface2D.prototype.base=null,Surface2D.prototype.Location=null,Surface2D.prototype.Size=null,Surface2D.prototype.Paint2DEventArgs=null,Surface2D.prototype.Shapes=[],Surface2D.prototype.OnPaint=function(a){Shape.prototype.OnPaint.call(this,a),this.ProjectedPoints=this.GetProjectedPoints(),a.Graphics.DrawSurface2D(this),null==this.Paint2DEventArgs&&(this.Paint2DEventArgs=new Paint2DEventArgs(new Graphics2D(a.Graphics))),this.OnPaint2D(this.Paint2DEventArgs)},Surface2D.prototype.OnPaint2D=function(a){for(var b=0;b<this.Shapes.length;b++){var c=this.Shapes[b].value;!c.IsRemoved&&c.IsVisibleOnRunner&&c.Location.x+c.Size.Width>this.Parent.ClipRectLocation.x&&c.Location.x<this.Parent.ClipRectLocation.x+this.Size.Width&&c.Location.y+c.Size.Height>this.Parent.ClipRectLocation.y&&c.Location.y<this.Parent.ClipRectLocation.y+this.Size.Height&&c.OnPaint(a)}},Surface2D.prototype.Invalidate=function(a){null==this.Paint2DEventArgs&&(this.Paint2DEventArgs=new Paint2DEventArgs(new Graphics2D(a.Graphics)));for(var b=0;b<this.Shapes.length;b++)this.Shapes[b].value.Invalidate(this.Paint2DEventArgs)},Surface2D.prototype.Create=function(){Shape.prototype.Create.call(this)},Surface2D.prototype.GetProjectedPoints=function(){var a=this.Parent.GetProjectedPoint1(this.Location),b=new Point3D(this.Location.x+this.Size.Width,this.Location.y,this.Location.z),c=new Point3D(this.Location.x,this.Location.y+this.Size.Height,this.Location.z),d=this.Parent.GetProjectedPoint1(b),e=this.Parent.GetProjectedPoint1(c);return new Array(a,d,e)},Surface2D.prototype.GetInstance=function(){return new Surface2D},Surface2D.prototype.Add=function(a){if(null==a.Name||""==a.Name){{var b=new Date;b.getTime()}a.Name="line3d"+Math.random().toString().replace(".","")}a.SetParent(this.Parent),a.SetContainer(this),a.Create(),this.Shapes.push({key:a.Name,value:a})},Surface2D.prototype.GetRectangleProjectedPoints=function(a){var b=new Point3D(this.Location.x+a.Location.x,this.Location.y+a.Location.y,this.Location.z),c=this.Parent.GetProjectedPoint1(b),d=new Point3D(b.x+a.Size.Width,b.y,b.z),e=new Point3D(b.x,b.y+a.Size.Height,b.z),f=this.Parent.GetProjectedPoint1(d),g=this.Parent.GetProjectedPoint1(e);return new Array(c,f,g)},Surface2D.prototype.GetPolygonProjectedPoints=function(a){for(var b=new Array(a.RelativePoints.length),c=0;c<a.RelativePoints.length;c++){var d=a.RelativePoints[c],e=new Point3D(this.Location.x+d.x,this.Location.y+d.y,this.Location.z);b[c]=this.Parent.GetProjectedPoint1(e)}return b},Surface2D.prototype.GetPolyProjectedPoints=function(a){for(var b=new Array(a.length),c=0;c<a.length;c++){var d=a[c],e=new Point3D(this.Location.x+d.x,this.Location.y+d.y,this.Location.z);b[c]=this.Parent.GetProjectedPoint1(e)}return b},Surface2D.prototype.GetSquareProjectedPoints=function(a){var b=new Point3D(this.Location.x+a.Location.x,this.Location.y+a.Location.y,this.Location.z),c=this.Parent.GetProjectedPoint1(b),d=new Point3D(b.x+a.Size,b.y,b.z),e=new Point3D(b.x,b.y+a.Size,b.z),f=this.Parent.GetProjectedPoint1(d),g=this.Parent.GetProjectedPoint1(e);return new Array(c,f,g)},Surface2D.prototype.GetCircleProjectedPoints=function(a){var b=new Point3D(this.Location.x+a.Center.x,this.Location.y+a.Center.y,this.Location.z),c=this.Parent.GetProjectedPoint1(b),d=new Point3D(b.x+a.Radius,b.y,b.z),e=this.Parent.GetProjectedPoint1(d);return[c,e]},Surface2D.prototype.GetEllipseProjectedPoints=function(a){var b=new Point3D(this.Location.x+a.Center.x,this.Location.y+a.Center.y,this.Location.z),c=this.Parent.GetProjectedPoint1(b),d=new Point3D(b.x+a.RadiusX,b.y,b.z),e=new Point3D(b.x,b.y+a.RadiusY,b.z),f=this.Parent.GetProjectedPoint1(d),g=this.Parent.GetProjectedPoint1(e);return[c,f,g]},Surface2D.prototype.GetLineProjectedPoints=function(a){var b=this.Parent.GetProjectedPoint1(new Point3D(a.RelativePoints[0].x+this.Location.x,a.RelativePoints[0].y+this.Location.y,this.Location.z)),c=this.Parent.GetProjectedPoint1(new Point3D(a.RelativePoints[1].x+this.Location.x,a.RelativePoints[1].y+this.Location.y,this.Location.z));return[b,c]},Surface2D.prototype.GetImage2DProjectedPoints=function(a){var b=new Point3D(this.Location.x+a.Location.x,this.Location.y+a.Location.y,this.Location.z);if(a.Rotatable){var c=new Point3D(this.Location.x+a.RotatePoint.x,this.Location.y+a.RotatePoint.y,this.Location.z);a.RotatePointProjected=c}var d=this.Parent.GetProjectedPoint1(b),e=new Point3D(b.x+a.Size.Width,b.y,b.z),f=new Point3D(b.x,b.y+a.Size.Height,b.z),g=this.Parent.GetProjectedPoint1(e),h=this.Parent.GetProjectedPoint1(f);return new Array(d,g,h)},Surface2D.prototype.GetLabel2DProjectedPoints=function(a){var b=new Point3D(this.Location.x+a.Location.x,this.Location.y+a.Location.y,this.Location.z),c=this.Parent.GetProjectedPoint1(b),d=new Point3D(b.x+a.Size.Width,b.y,b.z),e=new Point3D(b.x,b.y+a.Size.Height,b.z),f=this.Parent.GetProjectedPoint1(d),g=this.Parent.GetProjectedPoint1(e);return new Array(c,f,g)},Surface2D.prototype.GetShape2D=function(a){for(var b=0;b<this.Shapes.length;b++)if(a==this.Shapes[b].key)return this.Shapes[b].value;return null},Surface2D.prototype.pickAtScreen=function(a,b){for(var c=this.Shapes.length-1;c>=0;c--)if(this.Shapes[c].value.IsVisibleOnRunner){var d=this.Shapes[c].value;if(b){if(d.IsContains(new Point(a.x,a.y))){if(d.pickAtScreen){var e=d.pickAtScreen(a,b);if(null!=e)return e}return d}}else if(d.IsBorderContains(new Point(a.x,a.y)))return d}return null},Surface2D.prototype.pickAllAtScreen=function(a,b){for(var c=[],d=this.Shapes.length-1;d>=0;d--){var e=this.Shapes[d].value;if(b){if(e.IsContains(new Point(a.x,a.y))){if(e.pickAtScreen){var f=e.pickAtScreen(a,b);null!=f&&c.push(f)}c.push(e)}}else e.IsBorderContains(new Point(a.x,a.y))&&c.push(e)}return c},Surface2D.prototype.Remove=function(a){for(var b=0;b<this.Shapes.length;b++)if(this.Shapes[b].value==a){this.Shapes.splice(b,1);break}},Surface2D.prototype.ApplyRunnerSettings=function(){for(var a=0;a<this.Shapes.length;a++)this.Shapes[a].value.VisualMode="Run"},Shape2D.prototype=Object.create(Visual.prototype),Shape2D.prototype.ControlPointsHandler=null,Shape2D.prototype.Selected=!1,Shape2D.prototype.BorderWidth=1,Shape2D.prototype.Color=null,Shape2D.prototype.Location=null,Shape2D.prototype.Size=null,Shape2D.prototype.Origin=null,Shape2D.prototype.Alpha=0,Shape2D.prototype.Container=null,Shape2D.prototype.ParentContainer=null,Shape2D.prototype.SetContainer=function(a){this.Container=a,this.OnSetContainer()},Shape2D.prototype.OnSetContainer=function(){},Shape2D.prototype.SerializeAsSVG=function(a){var b=a;return null!=b&&(b.setAttribute("id",this.Name),b.setAttribute("stroke",this.Color.Value),b.setAttribute("stroke-width",this.BorderWidth),b.setAttribute("fill-opacity",this.AlphaFill/255),b.setAttribute("stroke-opacity",this.AlphaStroke/255)),b},Shape2D.prototype.Update=function(){null!=this.Parent&&this.Parent.Invalidate()},Shape2D.prototype.Create=function(){this.Created=!0},Shape2D.prototype.OnPaint=function(){},Shape2D.prototype.Invalidate=function(a){this.OnPaint(a)},Shape2D.prototype.OnMouseDown=function(a){Visual.prototype.OnMouseDown.call(this,a)},Shape2D.prototype.OnTouchStart=function(a){Visual.prototype.OnTouchStart.call(this,a)},Shape2D.prototype.OnMouseUp=function(a){Visual.prototype.OnMouseUp.call(this,a)},Shape2D.prototype.IsContains=function(){return!1},Shape2D.prototype.ResetGeometry=function(){},Shape2D.prototype.GetRelativePosition=function(a){var b=new Point(a.x+this.Origin.x,a.y+this.Origin.y);return b},Shape2D.prototype.GetPosition=function(a){var b=new Point(a.x-this.Origin.x,a.y-this.Origin.y);return b},Shape2D.prototype.IsBorderContains=function(){return!1},Shape2D.prototype.Clone=function(){var a=this.GetInstance();return this.Merge(a),a},Shape2D.prototype.GetInstance=function(){return null},Shape2D.prototype.Merge=function(a){a.Color=this.Color,a.Size=this.Size,a.BorderWidth=this.BorderWidth,a.Location=this.Location,a.AlphaStroke=this.AlphaStroke,a.AlphaFill=this.AlphaFill},Shape2D.prototype.GetObjectNamesOf=function(a){for(var b="",c=0;c<a.length;c++)b+=a[c].Name+",";return b.EndsWith(",")&&(b=b.Remove(b.Length-1,1)),b
},Shape2D.prototype.FillList=function(a,b){if(a.splice(0,a.length),""!=b&&null!=b)for(var c=b,d=c.split(","),e=0;e<d.length;e++){var f=d[e];a.push(this.Container.GetShape2D(f))}},Shape2D.prototype.Deselect=function(){1==this.Selected&&(this.ControlPointsHandler.ClearControlPoints(),this.Selected=!1,this.Parent.Refresh())},Shape2D.prototype.Render=function(){if(null!=this.ControlPointsHandler){var a=this.GetControlPoints();this.ControlPointsHandler.Render(a)}},Shape2D.prototype.GetControlPoints=function(){return null},Shape2D.prototype.MoveResize=function(){},Shape2D.prototype.Select=function(){if(!this.Selected){var a=this.GetControlPoints();this.ControlPointsHandler=new ControlPointsHandler2D(a),this.ControlPointsHandler.Parent=this,this.ControlPointsHandler.AddControlPoints(),this.Selected=!0,this.Parent.Refresh()}},Shape2D.prototype.LoadFromElement=function(a){if(Visual.prototype.LoadFromElement.call(this,a),null!=a)for(var b=0;b<a.attributes.length;b++){var c=a.attributes[b];switch(c.name){case"Color":var d=c.value.split(",");this.Color=new Color(parseInt(d[0]),parseInt(d[1]),parseInt(d[2]));break;case"Name":this.Name=c.value;break;case"BorderWidth":this.BorderWidth=parseInt(c.value);break;case"IsVisibleOnRunner":this.IsVisibleOnRunner="True"===c.value;break;case"AlphaStroke":this.AlphaStroke=parseInt(c.value);break;case"AlphaFill":this.AlphaFill=parseInt(c.value);break;case"FlipV":this.FlipV="True"===c.value;break;case"FlipH":this.FlipH="True"===c.value;break;case"Rotatable":this.Rotatable="True"===c.value;break;case"RotateAngle":this.RotateAngle=parseFloat(c.value);break;case"RotatePoint":var d=c.value.split(",");this.RotatePoint=new Point(parseInt(d[0]),parseInt(d[1]))}}},Image2D.prototype=Object.create(Shape2D.prototype),Image2D.prototype.ImageUrl="",Image2D.prototype.Image=null,Image2D.prototype.Visible=!0,Image2D.prototype.Create=function(){this.Created=!0},Image2D.prototype.OnPaint=function(a){null!=this.Image&&a.Graphics.DrawImage2D(this)},Image2D.prototype.GetInstance=function(){return new Image2D},Image2D.prototype.GetClipRect=function(){},Image2D.prototype.Merge=function(a){Shape2D.prototype.Merge.call(this,a),a.Image=this.Image,a.FillColor=this.FillColor},Image2D.prototype.Move=function(a){this.Location=a},Label2D.prototype=Object.create(Shape2D.prototype),Label2D.prototype.Text=null,Label2D.prototype.Font="",Label2D.prototype.Create=function(){this.Created=!0},Label2D.prototype.OnPaint=function(a){a.Graphics.DrawLabel2D(this)},Label2D.prototype.GetInstance=function(){return new Label2D},Label2D.prototype.GetClipRect=function(){},Label2D.prototype.Merge=function(a){Shape2D.prototype.Merge.call(this,a),a.Text=this.Text},Label2D.prototype.Move=function(a){this.Location=a},Rectangle2D.prototype=Object.create(Shape2D.prototype),Rectangle2D.prototype.base=null,Rectangle2D.prototype.FillColor=null,Rectangle2D.prototype.ObjectTobeInvalidated=null,Rectangle2D.prototype.ResizeEventHandlers=[],Rectangle2D.prototype.Create=function(){this.Created=!0},Rectangle2D.prototype.OnResize=function(){this.InvokeResizeEvent()},Rectangle2D.prototype.AddResizeEventHandler=function(a){this.ResizeEventHandlers.push(a)},Rectangle2D.prototype.InvokeResizeEvent=function(){for(var a=0;a<this.ResizeEventHandlers.length;a++)this.ResizeEventHandlers[a]()},Rectangle2D.prototype.OnPaint=function(a){a.Graphics.DrawRect2D(this)},Rectangle2D.prototype.Invalidate=function(){},Rectangle2D.prototype.GetInstance=function(){return new Rectangle2D(this.Location,this.Size)},Rectangle2D.prototype.Clone=function(){var a=this.GetInstance();return this.Merge(a),a},Rectangle2D.prototype.IsContains=function(a){var b=this.Location.x,c=this.Location.x+this.Size.Width,d=this.Location.y,e=this.Location.y+this.Size.Height;return a.x>=b&&a.x<=c&&a.y>=d&&a.y<=e?!0:!1},Rectangle2D.prototype.MoveResize=function(a,b,c){switch(c){case 0:this.Location=new Point(this.Location.x-a,this.Location.y-b),this.Render();break;case 1:this.Size=new Size(this.Size.Width+a,this.Size.Height+b),this.Location=new Point(this.Location.x-a,this.Location.y-b),this.Render();break;case 2:this.Size=new Size(this.Size.Width-a,this.Size.Height+b),this.Location=new Point(this.Location.x,this.Location.y-b),this.Render();break;case 3:this.Size=new Size(this.Size.Width-a,this.Size.Height-b),this.Render();break;case 4:this.Size=new Size(this.Size.Width+a,this.Size.Height-b),this.Location=new Point(this.Location.x-a,this.Location.y),this.Render();break;case 5:this.Size=new Size(this.Size.Width+a,this.Size.Height),this.Location=new Point(this.Location.x-a,this.Location.y),this.Render();break;case 6:this.Size=new Size(this.Size.Width,this.Size.Height+b),this.Location=new Point(this.Location.x,this.Location.y-b),this.Render();break;case 7:this.Size=new Size(this.Size.Width-a,this.Size.Height),this.Render();break;case 8:this.Size=new Size(this.Size.Width,this.Size.Height-b),this.Render()}},Rectangle2D.prototype.Move=function(a){this.Location=a,this.Render()},Rectangle2D.prototype.GetClipRect=function(){},Rectangle2D.prototype.Render=function(){Shape2D.prototype.Render.call(this),this.Parent.Refresh()},Rectangle2D.prototype.GetControlPoints=function(){var a=this.GetRelativePosition(new Point(this.Location.x,this.Location.y)),b=this.GetRelativePosition(new Point(this.Location.x+this.Size.Width,this.Location.y)),c=this.GetRelativePosition(new Point(this.Location.x+this.Size.Width,this.Location.y+this.Size.Height)),d=this.GetRelativePosition(new Point(this.Location.x,this.Location.y+this.Size.Height)),e=this.GetRelativePosition(new Point(this.Location.x,this.Location.y+this.Size.Height/2)),f=this.GetRelativePosition(new Point(this.Location.x+this.Size.Width/2,this.Location.y)),g=this.GetRelativePosition(new Point(this.Location.x+this.Size.Width,this.Location.y+this.Size.Height/2)),h=this.GetRelativePosition(new Point(this.Location.x+this.Size.Width/2,this.Location.y+this.Size.Height)),i=[a,b,c,d,e,f,g,h];return i},Rectangle2D.prototype.Merge=function(a){Shape2D.prototype.Merge.call(this,a),a.FillColor=this.FillColor},Line2D.prototype=Object.create(Shape2D.prototype),Line2D.prototype.RelativePoints=[],Line2D.prototype.Start=null,Line2D.prototype.End=null,Line2D.prototype.OnPaint=function(a){a.Graphics.DrawLine(this)},Line2D.prototype.Invalidate=function(){},Line2D.prototype.Create=function(){this.CalculateRelativePoints();var a=this.GetClipRect();this.Location=a.Location,this.Size=a.Size,this.Created=!0},Line2D.prototype.GetInstance=function(){return new Line2D(this.Start,this.End)},Line2D.prototype.Clone=function(){var a=this.GetInstance();return this.Merge(a),a},Line2D.prototype.MoveTo=function(a,b){this.Origin=new Point(this.Origin.x-a,this.Origin.y-b),this.Location=new Point(this.Location.x-a,this.Location.y-b),this.CalculateRelativePoints(),this.Render()},Line2D.prototype.MoveEndPoint=function(a,b){this.End=new Point(this.End.x-a,this.End.y-b),this.RelativePoints[1]=this.GetRelativePosition(this.End),this.Render()},Line2D.prototype.MoveStartPoint=function(a,b){this.Start=new Point(this.Start.x-a,this.Start.y-b),this.RelativePoints[0]=this.GetRelativePosition(this.Start),this.Render()},Line2D.prototype.MoveResize=function(a,b,c){switch(c){case 0:this.MoveTo(a,b);break;case 1:this.MoveStartPoint(a,b);break;case 2:this.MoveEndPoint(a,b)}},Line2D.prototype.Render=function(){Shape2D.prototype.Render.call(this),this.Parent.Refresh()},Line2D.prototype.GetControlPoints=function(){var a=this.RelativePoints[0],b=this.RelativePoints[1],c=[a,b];return c},Line2D.prototype.Merge=function(a){Shape2D.prototype.Merge.call(this,a);var b=a;b.Origin=this.Origin,b.Start=this.Start,b.End=this.End},Line2D.prototype.GetClipRect=function(){for(var a=1e6,b=1e6,c=0,d=0,e=0;e<this.RelativePoints.length;e++)a>this.RelativePoints[e].x&&(a=this.RelativePoints[e].x),b>this.RelativePoints[e].y&&(b=this.RelativePoints[e].y),c<this.RelativePoints[e].x&&(c=this.RelativePoints[e].x),d<this.RelativePoints[e].y&&(d=this.RelativePoints[e].y);return a>=c||b>=d?{Location:new Point(this.RelativePoints[0].x,this.RelativePoints[0].y),Size:new Size(1,20)}:{Location:new Point(a,b),Size:new Size(c-a,d-b)}},Line2D.prototype.CalculateRelativePoints=function(){this.RelativePoints[0]=this.GetRelativePosition(this.Start),this.RelativePoints[1]=this.GetRelativePosition(this.End)},Line2D.prototype.Move=function(a){this.Origin=new Point(a.x+this.Origin.x,a.y+this.Origin.y),this.CalculateRelativePoints()},Square2D.prototype=Object.create(Shape2D.prototype),Circle2D.prototype=Object.create(Shape2D.prototype),Ellipse2D.prototype=Object.create(Shape2D.prototype),Polygon.prototype=Object.create(Shape2D.prototype),Polygon.prototype.Create=function(){this.RelativePoints=[],this.CalculateRelativePoints();var a=this.GetClipRect();this.Location=a.Location,this.Size=a.Size,this.PointsCollection=[],this.Poit3DCollection=[],this.CreateWindowsPoints(),this.BuildRegularPolygon(),Shape2D.prototype.Create.call(this)},Polyline.prototype=Object.create(Polygon.prototype),Polyline.prototype.Create=function(){Polygon.prototype.Create.call(this)},MagneticSelection.prototype=Object.create(Polyline.prototype),PolylineCurved.prototype=Object.create(Polyline.prototype),PolyquadCurve.prototype=Object.create(Polyline.prototype),Size.prototype.Width=0,Size.prototype.Height=0,Graphics2D.prototype.ViewPort=null,Graphics2D.prototype.Clear=function(a){this.ViewPort.Clear(a)},Graphics2D.prototype.Update=function(){this.ViewPort.Update()},Graphics2D.prototype.DrawText=function(a){var b=a.Container;if(null!=b){var c=b.GetRectangleProjectedPoints(a);this.ViewPort.DrawText(c[0],c[1].x-c[0].x,c[2].y-c[0].y,a)}},Graphics2D.prototype.DrawImage2D=function(a){var b=a.Container;if(null!=b){var c=b.GetImage2DProjectedPoints(a);this.ViewPort.DrawImage2D(c[0],c[1].x-c[0].x,c[2].y-c[0].y,a.Color,a.BorderWidth,a.Alpha,a)}},Graphics2D.prototype.DrawLabel2D=function(a){var b=a.Container;if(null!=b){var c=b.GetLabel2DProjectedPoints(a);this.ViewPort.DrawLabel2D(c[0],c[1].x-c[0].x,c[2].y-c[0].y,a)}},Graphics2D.prototype.DrawLine=function(a){var b=a.Container;if(null!=b){var c=b.GetLineProjectedPoints(a);this.ViewPort.DrawLine(c[0],c[1],a)}},Graphics2D.prototype.DrawCircle2D=function(a){var b=a.Container;if(null!=b){var c=b.GetCircleProjectedPoints(a);this.ViewPort.DrawCircle(c[0],c[1].x-c[0].x,a)}},Graphics2D.prototype.DrawEllipse2D=function(a){var b=a.Container;if(null!=b){var c=b.GetEllipseProjectedPoints(a);this.ViewPort.DrawEllipse(c[0],c[1].x-c[0].x,c[2].y-c[0].y,a)}},Graphics2D.prototype.DrawRect2D=function(a){var b=a.Container;if(null!=b){var c=b.GetRectangleProjectedPoints(a);this.ViewPort.DrawRectangle(c[0],c[1].x-c[0].x,c[2].y-c[0].y,a)}},Graphics2D.prototype.DrawSquare2D=function(a){var b=a.Container;if(null!=b){var c=b.GetSquareProjectedPoints(a);this.ViewPort.DrawSquare(c[0],c[1].x-c[0].x,c[2].y-c[0].y,a)}},Graphics3D.prototype.ViewPort=null,Point3D.prototype.x=0,Point3D.prototype.y=0,Point3D.prototype.z=0,Point3D.prototype.Equals=function(a){return this.x==a.x&&this.y==a.y&&this.z==a.z?!0:!1},Point.prototype.x=0,Point.prototype.y=0,Point.prototype.Equals=function(a){return this.x==a.x&&this.y==a.y?!0:!1},Point.prototype.Clone=function(){return new Point(this.x,this.y)},Angle3D.prototype.x=0,Angle3D.prototype.y=0,Angle3D.prototype.z=0,Angle3D.prototype.Equals=function(a){return this.x==a.x&&this.y==a.y&&this.z==a.z?!0:!1},Paint3DEventListener.prototype.Paint=null,PaintInitEventListener.prototype.InitPaint=null,Paint2DEventArgs.prototype.Graphics=null,Paint3DEventArgs.prototype.Graphics=null,KeyPressEventListener.prototype.KeyPress=null,KeyEventArgs.prototype.Key=null,KeyEventArgs.prototype.evt=null,MouseEventArgs.prototype.button=null,MouseEventArgs.prototype.x=null,MouseEventArgs.prototype.y=null,MouseEventArgs.prototype.actual=null,Game.prototype.Geoport=null,Game.prototype.Controller=null,Game.prototype.Load=function(){},Game.prototype.Initiate=function(a){var b=new Geoport;this.Geoport=b;var c=this;b.levelInit(function(a){c.onLoadXml(a)}),b.AddLoadedEventListener(function(a){c.onLevelLoaded(a)}),b.AddKeyPressEventListener(new KeyPressEventListener(function(a){c.GeoPort_KeyPress(a)})),b.initiate();var d=new Controller(b);d.LoadFrom(a),d.StartGame(),this.Controller=d},Game.prototype.loadLevel=function(a){this.Controller.LoadLevel(a)},Game.prototype.CheckKeyPress=function(){if(keydown)if(38==downkey){this.Value>50&&(this.Value-=this.Value/10);var a=this.Geoport;a.CameraPosition=new Point3D(a.CameraPosition.x,a.CameraPosition.y,this.Value),a.Refresh()}else if(40==downkey){this.Value<14e3&&(this.Value+=this.Value/10);var a=this.Geoport;a.CameraPosition=new Point3D(a.CameraPosition.x,a.CameraPosition.y,this.Value),a.Refresh()}else if(39==downkey){var a=this.Geoport;a.CameraPosition=new Point3D(a.CameraPosition.x+40,a.CameraPosition.y,this.Value),a.Refresh()}else if(37==downkey){var a=this.Geoport;a.CameraPosition=new Point3D(a.CameraPosition.x-40,a.CameraPosition.y,this.Value),a.Refresh()}},Game.prototype.Value=1500,Game.prototype.count=0,Game.prototype.SetCamara=function(){var a=this.Geoport;a.CameraPosition=new Point3D(a.CameraPosition.x,a.CameraPosition.y,this.Value),a.Refresh();var b=this;this.count<3&&(setTimeout(function(){b.Draw()},10),this.count++)},Game.prototype.Draw=function(){var a=this.Value;this.up?(a>50&&(a-=a/30),this.SetCamara()):this.down&&(14e3>a&&(a+=a/30),this.SetCamara()),this.Value=a},Game.prototype.up=!1,Game.prototype.down=!0,Game.prototype.GeoPort_KeyPress=function(a){38==a.Key?(this.count=0,this.up=!0,this.down=!1,this.SetCamara()):40==a.Key&&(this.count=0,this.up=!1,this.down=!0,this.SetCamara())};var getGeoPorts=[function(){return[new Color(184,134,11),[new Surface2D("Surface2D247865930",new Point3D(0,0,0),new Size(1366,768),[new Image2D("Image2D1955768",new Color(218,165,32),2,"None",new Point(383,244),new Size(523,100),"src/geospace/Images/star.bmp",!1),new AlphaChannel("AlphaChannel2095171",new Color(255,0,0),0,new Point(234,222),"Image2D1955768",new Size(810,194),100,"NextPage")])]]},function(){return[new Color(0,255,11),[new Surface2D("Surface2D247865931",new Point3D(0,0,0),new Size(1366,768),[new Rectangle2D("Rectangle2D24800804",new Color(218,165,32),2,"None",new Point(383,244),new Size(523,100),new Color(165,42,42))])]]},function(){return[new Color(184,134,11),[new Surface2D("Surface2D247865930",new Point3D(0,0,0),new Size(1366,768),[new Rectangle2D("Rectangle2D24800804",new Color(218,165,32),2,"None",new Point(383,244),new Size(523,100),new Color(165,42,42))])]]},function(){return[new Color(184,134,11),[new Surface2D("Surface2D247865930",new Point3D(0,0,0),new Size(1366,768),[new Rectangle2D("Rectangle2D24800804",new Color(218,165,32),2,"None",new Point(383,244),new Size(523,100),new Color(165,42,42))])]]}];Controller.prototype.Geoport=null,Controller.prototype.Loader=null,Controller.prototype.Currenttype="Front",Controller.prototype.Currentfileindex=0,Controller.prototype.Lifes=null,Controller.prototype.Score=null,Controller.prototype.LoadFrom=function(a){this.Loader.LoadFrom(a);var b=this;this.Geoport.AddGeoportCommandListener(function(a){switch(a){case"NextPage":b.NextPage();break;case"QuitGame":b.Quit();break;case"RestartGame":b.RestartGame();break;case"RestartLevel":b.RestartLevel()}})},Controller.prototype.NextPage=function(){this.Currentfileindex++,this.PlayCurrentFile()},Controller.prototype.LoadLevel=function(a){this.Loader.Levels.length>a&&a>=0&&(this.Currenttype="Level",this.Currentfileindex=a,this.PlayCurrentFile())},Controller.prototype.Quit=function(){this.Loader.Dispose()},Controller.prototype.RestartGame=function(){this.StartGame()},Controller.prototype.RestartLevel=function(){this.Lifes<=0&&(this.Currentfileindex="GameOver"),this.PlayCurrentFile(),this.Lifes--},Controller.prototype.StartGame=function(){this.Currentfileindex=0,this.Currenttype="Front",this.Lifes=this.Loader.Lives,this.PlayCurrentFile()},Controller.prototype.EndGame=function(){this.Currenttype="End",this.PlayCurrentFile()},Controller.prototype.LoadElement=function(a){this.Geoport.LoadFromFile(a),this.Geoport.Refresh()},Controller.prototype.PlayCurrentFile=function(){switch(this.Currenttype){case"Front":this.Loader.FrontPages.length==this.Currentfileindex?(this.Currenttype="Level",this.Currentfileindex=0,this.PlayCurrentFile()):this.LoadElement(this.Loader.FrontPages[this.Currentfileindex]);break;case"Level":this.Loader.Levels.length==this.Currentfileindex?(this.Currenttype="End",this.Currentfileindex=0,this.PlayCurrentFile()):this.LoadElement(this.Loader.Levels[this.Currentfileindex]);break;case"End":this.LoadElement(this.Loader.EndPage);break;case"GameOver":this.LoadElement(this.Loader.GameOverPage)}},Loader.prototype.Dispose=function(){this.RemoveAll()},Loader.prototype.RemoveAll=function(){null!=this.LifeImage&&this.LifeImage.Dispose(),null!=this.ScoreImage&&this.ScoreImage.Dispose();for(var a=0;a<this.FontImages.lenth;a++)this.FontImages[a].Dispose();this.FrontPage=null,this.Levels=null,this.EndPage=null,this.GameOverPage=null},SingleShapeVisual.prototype=Object.create(Shape2D.prototype),SingleShapeVisual.prototype.VisualSource="",SingleShapeVisual.prototype.Shape=null,SingleShapeVisual.prototype.RepeaterShape=null,SingleShapeVisual.prototype.AddShape=function(){if(this.Shape=this.Container.GetShape2D(this.VisualSource),null!=this.Shape){var a=this.Shape.Clone();a.Create(),this.Rotatable&&(a.Rotatable=!0,a.RotateAngle=this.RotateAngle,a.RotatePoint=this.RotatePoint),this.RepeaterShape=a,this.RepeaterShape.SetParent(this.Parent),this.RepeaterShape.SetContainer(this.Container)}},SingleShapeVisual.prototype.OnSetContainer=function(){null!=this.Shape&&(this.Shape.Container=this.Container,this.RepeaterShape.Container=this.Container)},SingleShapeVisual.prototype.Parent_LoadedFromFile=function(){null==this.Shape&&""!=this.VisualSource&&this.AddShape()},SingleShapeVisual.prototype.OnSetParent=function(){Visual.prototype.OnSetParent.call(this),null!=this.Parent&&null!=this.Shape&&(this.Shape.Parent=this.Parent,this.RepeaterShape.Parent=this.Parent)},SingleShapeVisual.prototype.Create=function(){this.Created=!0},SingleShapeVisual.prototype.Add=function(a){if(null!=this.Shape&&(this.Shape.CanRemove=!0,this.RepeaterShape.Dispose()),null==a.Name||""==a.Name){var b=new Date,c=b.getTime();a.Name="line3d"+c}a.Parent=this.Parent,a.Container=this.Container,a.Create();var d=a.Clone();d.Parent=this.Parent,d.Container=this.Container,d.Create(),this.RepeaterShape=d,this.Shape=a},SingleShapeVisual.prototype.Dispose=function(){this.RepeaterShape.Dispose()},SingleShapeVisual.prototype.LoadFromElement=function(a){if(Shape2D.prototype.LoadFromElement.call(this,a),null!=a)for(var b=0;b<a.attributes.length;b++){var c=a.attributes[b];switch(c.name){case"Size":var d=c.value.split(",");this.Size=new Size(parseInt(d[0]),parseInt(d[1]));break;case"Location":var d=c.value.split(",");this.Location=new Point(parseInt(d[0]),parseInt(d[1]));break;case"VisualSource":this.VisualSource=c.value}}},ControlPointsHandler.prototype.Anchors=[],ControlPointsHandler.prototype.Points=null,ControlPointsHandler.prototype.Parent=null,ControlPointsHandler.prototype.AddControlPoints=function(){for(var a=this.Parent,b=a.GetControlPoints(),c=1,d=0;d<b.length;d++){var e=b[d],f=this.CreateControlPoint(e);this.Parent.Parent.AddAnchor(f),this.AddMesh(this.Parent,f,c),c++}this.ChangeAnchorAppearance()},ControlPointsHandler.prototype.AddMesh=function(a,b,c){this.Parent.Parent.AddAnchorMesh(this.Parent,b,c)},ControlPointsHandler.prototype.CreateControlPoint=function(){},ControlPointsHandler.prototype.ChangeAnchorAppearance=function(){},ControlPointsHandler.prototype.CreateMesh=function(a){return a},ControlPointsHandler.prototype.Render=function(){},ControlPointsHandler.prototype.Refresh=function(){this.ClearControlPoints(),this.AddControlPoints()},ControlPointsHandler.prototype.Deselect=function(){},ControlPointsHandler.prototype.ClearControlPoints=function(){this.Parent.Parent.RemoveAnchors(),this.Anchors.splice(0,this.Anchors.length),this.Deselect()},ControlPointsHandler2D.prototype=Object.create(ControlPointsHandler.prototype),ControlPointsHandler2D.prototype.CreateControlPoint=function(a){var b=new Size(6,6);a=new Point(a.x-b.Width/2,a.y-b.Width/2);var c=new Rectangle2D(a,new Size(6,6));c.Color=new Color(30,170,170,255),c.FillColor=new Color(20,150,150,255),c.AlphaFill=255,c.BorderWidth=2;var d=this.CreateMesh(c);return this.Anchors.push(c),d},ControlPointsHandler2D.prototype.ChangeAnchorAppearance=function(){},ControlPointsHandler2D.prototype.Render=function(a){this.Points=a;for(var b=0;b<this.Anchors.length;b++){var c=this.Anchors[b];null!=c&&(c.Location=new Point(a[b].x-c.Size.Width/2,a[b].y-c.Size.Width/2),c.Render())}},AlphaChannel.prototype=Object.create(SingleShapeVisual.prototype),AlphaChannel.prototype.OnAlphaEnd="None",AlphaChannel.prototype.Interval=100,AlphaChannel.prototype.nextHitTime=new Date,AlphaChannel.prototype._val=0,AlphaChannel.prototype._inc=!0,AlphaChannel.prototype.goingUp=!0,AlphaChannel.prototype.Visible=!0,AlphaChannel.prototype.OnSetParent=function(){if(null!=this.Parent){SingleShapeVisual.prototype.OnSetParent.call(this);var a=this;this.Parent.AddPaintInitEventListener(new PaintInitEventListener(function(){a.Parent_PaintInit()}))}},AlphaChannel.prototype.OnParentChangeInvoke=function(a){this.Parent!=a&&null!=this.Parent},AlphaChannel.prototype.Parent_PaintInit=function(){"Run"==this.VisualMode&&this.nextHitTime.valueOf()<=(new Date).valueOf()&&(this.Parent.Refresh(),this.nextHitTime.setMilliseconds((new Date).getMilliseconds()+this.Interval))},AlphaChannel.prototype.Dispose=function(){},AlphaChannel.prototype.OnPaint=function(a){if(null!=this.Shape){var b=this.RepeaterShape,c=this.Shape;if(c.Merge(b),b.Visible=!0,b.Move(new Point(this.Location.x,this.Location.y)),b.Location.x+b.Size.Width>this.Parent.ClipRectLocation.x&&b.Location.x<this.Parent.ClipRectLocation.x+this.Container.Size.Width&&b.Location.y+b.Size.Height>this.Parent.ClipRectLocation.y&&b.Location.y<this.Parent.ClipRectLocation.y+this.Container.Size.Height){if("Run"==this.VisualMode&&1==this.Visible)if(0==this.goingUp){if(b.Alpha=b.Alpha-.01,b.Alpha<0)return this.Visible=!1,void this.CommandAlphaEnd()}else b.Alpha=b.Alpha+.01,b.Alpha>1&&(this.goingUp=!1);b.Invalidate(a)}this.Size=this.Shape.Size}},AlphaChannel.prototype.CommandAlphaEnd=function(){"None"!=this.OnAlphaEnd&&this.Parent.ExecuteCommand(this.OnAlphaEnd)},MultiShapeVisual.prototype=Object.create(Shape2D.prototype),MultiShapeVisual.prototype.LoadFromElement=function(a){if(Shape2D.prototype.LoadFromElement.call(this,a),null!=a)for(var b=0;b<a.attributes.length;b++){var c=a.attributes[b];switch(c.name){case"Location":var d=c.value.split(",");this.Location=new Point(parseInt(d[0]),parseInt(d[1]));break;case"VisualSources":this.VisualSources=c.value}}},MultiShapeVisual.prototype.Parent_LoadedFromFile=function(){Shape2D.prototype.Parent_LoadedFromFile.call(this),0==this._shapes.length&&""!=this.VisualSources&&null!=this.VisualSources&&this.AddShapes()},MultiShapeVisual.prototype.OnParentChange=function(a){Shape2D.prototype.OnParentChange.call(this,a);for(var b=0;b<this._shapes.length;b++)this._shapes[b].Parent=this.Parent,this._repeaterShapes[b].Parent=this.Parent},MultiShapeVisual.prototype.OnMouseDown=function(a){Shape2D.prototype.OnMouseDown.call(this,a)},MultiShapeVisual.prototype.OnTouchStart=function(a){Shape2D.prototype.OnTouchStart.call(this,a)},ComplexShape.prototype=Object.create(MultiShapeVisual.prototype),ComplexShape.prototype.LoadFromElement=function(a){if(MultiShapeVisual.prototype.LoadFromElement.call(this,a),null!=a)for(var b=0;b<a.attributes.length;b++){var c=a.attributes[b];switch(c.name){case"Size":var d=c.value.split(",");this.Size=new Size(parseInt(d[0]),parseInt(d[1]))}}},Animator.prototype=Object.create(MultiShapeVisual.prototype),Animator.prototype.OnMouseDown=function(a){MultiShapeVisual.prototype.OnMouseDown.call(this,a),this.handleAnimatorMouseDown(a)},Animator.prototype.OnTouchStart=function(a){MultiShapeVisual.prototype.OnTouchStart.call(this,a),this.handleAnimatorTouchStart(a)},Animator.prototype.LoadFromElement=function(a){if(MultiShapeVisual.prototype.LoadFromElement.call(this,a),null!=a)for(var b=0;b<a.attributes.length;b++){var c=a.attributes[b];switch(c.name){case"FrameOrder":this.FrameOrder=c.value;break;case"Interval":this.Interval=parseInt(c.value);break;case"AnimationMode":this.AnimationMode=c.value;break;case"RepeatCount":this.RepeatCount=parseInt(c.value);break;case"AnimateOnMouseDown":this.AnimateOnMouseDown="True"===c.value;break;case"OnStart":this.OnStartLabel=c.value;break;case"OnEnd":this.OnEndLabel=c.value;break;case"Size":var d=c.value.split(",");this.Size=new Size(parseInt(d[0]),parseInt(d[1]));break;case"OnDestroy":this.OnDestroyLabel=c.value;break;case"OnDestroying":this.OnDestroyingLabel=c.value;break;case"OnMove":this.OnMoveLabel=c.value}}},Repeater.prototype=Object.create(SingleShapeVisual.prototype),Repeater.prototype.IsContains=function(a){var b=this.Location.x,c=this.Location.x+this.Size.Width,d=this.Location.y,e=this.Location.y+this.Size.Height;return a.x>=b&&a.x<=c&&a.y>=d&&a.y<=e?!0:!1},RandomRepeater.prototype=Object.create(SingleShapeVisual.prototype),RandomRepeater.prototype.LoadFromElement=function(a){if(SingleShapeVisual.prototype.LoadFromElement.call(this,a),null!=a){for(var b=0;b<a.attributes.length;b++){var c=a.attributes[b];switch(c.name){case"Size":var d=c.value.split(",");this.Size=new Size(parseInt(d[0]),parseInt(d[1]));break;case"RepeatCount":this.RepeatCount=parseInt(c.value)}}for(var b=0;b<a.childNodes.length;b++){var e=a.childNodes[b];if(e.attributes)for(var b=0;b<e.attributes.length;b++){var c=e.attributes[b];switch(c.name){case"Point":var d=c.value.split(","),f=new Point(parseInt(d[0]),parseInt(d[1]));this._randomPoints.push(f)}}}}},SpriteVisual.prototype=Object.create(RandomRepeater.prototype),WalkableAnimator.prototype=Object.create(Animator.prototype),Box3D.prototype=Object.create(Shape.prototype),Box3D.prototype.OnPaint=function(a){Shape.prototype.OnPaint.call(this,a),this.ProjectedPoints=this.GetProjectedPoints(),a.Graphics.DrawLine3D(this)},Box3D.prototype.Invalidate=function(){},Box3D.prototype.Create=function(){Shape.prototype.Create.call(this)},Box3D.prototype.GetProjectedPoints=function(){var a=this.Parent.GetProjectedPoint1(this.x),b=this.Parent.GetProjectedPoint1(this.y);return new Array(a,b)},Box3D.prototype.GetInstance=function(){return new Line3D},Blinker.prototype=Object.create(SingleShapeVisual.prototype),Blinker.prototype.Interval=500,Blinker.prototype.nextHitTime=new Date,Blinker.prototype.OnSetParent=function(){if(null!=this.Parent){SingleShapeVisual.prototype.OnSetParent.call(this);var a=this;this.Parent.AddPaintInitEventListener(function(){a.Parent_PaintInit()})}},Blinker.prototype.OnParentChangeInvoke=function(a){this.Parent!=a&&null!=this.Parent},Blinker.prototype.Parent_PaintInit=function(){"Run"==this.VisualMode&&this.nextHitTime.valueOf()<=(new Date).valueOf()&&(canpaint=!canpaint,this.nextHitTime.setMilliseconds((new Date).getMilliseconds()+this.Interval),this.Parent.Refresh())},Blinker.prototype.Dispose=function(){};var canpaint=!0;Blinker.prototype.OnPaint=function(a){if(canpaint&&null!=this.Shape){var b=this.RepeaterShape,c=this.Shape;c.Merge(b),b.Move(new Point(this.Location.x,this.Location.y)),b.Location.x+b.Size.Width>this.Parent.ClipRectLocation.x&&b.Location.x<this.Parent.ClipRectLocation.x+this.Container.Size.Width&&b.Location.y+b.Size.Height>this.Parent.ClipRectLocation.y&&b.Location.y<this.Parent.ClipRectLocation.y+this.Container.Size.Height&&b.OnPaint(a),this.Size=this.Shape.Size}},Cursor.prototype=Object.create(Blinker.prototype),Cursor.prototype.Create=function(){var a=new Line2D(new Point(0,0),new Point(0,10),new Point(0,30));a.Color=new Color(10,10,100,100),a.BorderWidth=1,a.Origin=this.GetRelativePosition(this.Location),this.Add(a),this.Created=!0},ContainerControl.prototype=Object.create(Rectangle2D.prototype),ContainerControl.prototype.Create=function(){Rectangle2D.prototype.Create(this)},ContainerControl.prototype.OnPaint=function(a){Rectangle2D.prototype.OnPaint.call(this,a),this.OnPaint2D(a)},ContainerControl.prototype.OnPaint2D=function(a){for(var b=0;b<this.Shapes.length;b++){var c=this.RepeaterShapes[b],d=this.Shapes[b].value;d.Merge(c),c.Location=new Point(this.Location.x+d.Location.x,this.Location.y+d.Location.y),d.Origin=this.GetRelativePosition(this.Location),c.OnPaint(a)}},ContainerControl.prototype.pickAtScreen=function(a,b){for(var c=new Point(a.x-this.Location.x,a.y-this.Location.y),d=this.Shapes.length-1;d>=0;d--){var e=this.Shapes[d].value;if(b){if(e.IsContains(c)){if(e.pickAtScreen){var f=e.pickAtScreen(c,b);if(null!=f)return f}return e}}else if(e.IsBorderContains(new Point(a.x,a.y)))return e}return null},ContainerControl.prototype.Remove=function(a){for(var b=0;b<this.Shapes.length;b++)if(this.Shapes[b].value==a){this.Shapes.splice(b,1);break}},ContainerControl.prototype.MoveResize=function(a,b,c){Rectangle2D.prototype.MoveResize.call(this,a,b,c)},ContainerControl.prototype.Add=function(a){if(null==a.Name||""==a.Name){{var b=new Date;b.getTime()}a.Name="line3d"+Math.random().toString().replace(".","")}a.SetParent(this.Parent),a.SetContainer(this.Container),a.ParentContainer=this,a.Origin=this.GetRelativePosition(this.Location),a.Create(),this.Shapes.push({key:a.Name,value:a});var c=a.GetInstance();c.Parent=this.Parent,c.Container=this.Container,c.Origin=this.GetRelativePosition(this.Location),c.Create(),this.RepeaterShapes.push(c)},ContainerControl.prototype.GetLocation=function(a,b){return new Point(a.x-b.x,a.y-b.y)},WebPage.prototype=Object.create(ContainerControl.prototype),ImageBackground.prototype=Object.create(ContainerControl.prototype),ImageBackground.prototype.MoveResize=function(a,b,c){switch(c){case 1:this.Size=new Size(this.Size.Width-a,this.Size.Height-b),this.Render();break;case 2:this.Size=new Size(this.Size.Width-a,this.Size.Height),this.Render();break;case 3:this.Size=new Size(this.Size.Width,this.Size.Height-b),this.Render()}},ImageBackground.prototype.GetControlPoints=function(){var a=this.GetRelativePosition(new Point(this.Location.x+this.Size.Width,this.Location.y+this.Size.Height)),b=this.GetRelativePosition(new Point(this.Location.x+this.Size.Width,this.Location.y+this.Size.Height/2)),c=this.GetRelativePosition(new Point(this.Location.x+this.Size.Width/2,this.Location.y+this.Size.Height)),d=[a,b,c];return d},Header.prototype=Object.create(ContainerControl.prototype),Header.prototype.GetControlPoints=function(){var a=new Point(this.Location.x+this.Size.Width/2,this.Location.y+this.Size.Height),b=[a];return b},Header.prototype.MoveResize=function(a,b,c){switch(c){case 1:this.Size=new Size(this.Size.Width,this.Size.Height-b),this.OnResize(),this.Render()}},Navigation.prototype=Object.create(ContainerControl.prototype),Navigation.prototype.GetControlPoints=function(){var a=new Point(this.Location.x+this.Size.Width/2,this.Location.y+this.Size.Height),b=[a];return b},Navigation.prototype.MoveResize=function(a,b,c){switch(c){case 1:this.Size=new Size(this.Size.Width,this.Size.Height-b),this.OnResize(),this.Render()}},RightPane.prototype=Object.create(ContainerControl.prototype),RightPane.prototype.GetControlPoints=function(){var a=new Point(this.Location.x,this.Location.y+this.Size.Height/2),b=[a];return b},RightPane.prototype.MoveResize=function(a,b,c){switch(c){case 1:this.Size=new Size(this.Size.Width+a,this.Size.Height),this.Location=new Point(this.Location.x-a,this.Location.y),this.OnResize(),this.Render()}},LeftPane.prototype=Object.create(ContainerControl.prototype),LeftPane.prototype.GetControlPoints=function(){var a=new Point(this.Location.x+this.Size.Width,this.Location.y+this.Size.Height/2),b=[a];return b},LeftPane.prototype.MoveResize=function(a,b,c){switch(c){case 1:this.Size=new Size(this.Size.Width-a,this.Size.Height),this.OnResize(),this.Render()}},ContentPane.prototype=Object.create(ContainerControl.prototype),ContentPane.prototype.GetControlPoints=function(){var a=new Point(this.Location.x+this.Size.Width,this.Location.y+this.Size.Height/2),b=new Point(this.Location.x,this.Location.y+this.Size.Height/2),c=[a,b];
return c},ContentPane.prototype.MoveResize=function(a,b,c){switch(c){case 1:this.Size=new Size(this.Size.Width-a,this.Size.Height),this.Render();break;case 2:this.Size=new Size(this.Size.Width+a,this.Size.Height),this.Location=new Point(this.Location.x-a,this.Location.y),this.Render()}},TopPane.prototype=Object.create(ContainerControl.prototype),TopPane.prototype.GetControlPoints=function(){var a=new Point(this.Location.x+this.Size.Width/2,this.Location.y+this.Size.Height),b=[a];return b},TopPane.prototype.MoveResize=function(a,b,c){switch(c){case 1:this.Size=new Size(this.Size.Width,this.Size.Height-b),this.OnResize(),this.Render()}},BottomPane.prototype=Object.create(ContainerControl.prototype),BottomPane.prototype.GetControlPoints=function(){var a=new Point(this.Location.x+this.Size.Width/2,this.Location.y),b=[a];return b},BottomPane.prototype.MoveResize=function(a,b,c){switch(c){case 1:this.Size=new Size(this.Size.Width,this.Size.Height+b),this.Location=new Point(this.Location.x,this.Location.y-b),this.OnResize(),this.Render()}},Footer.prototype=Object.create(ContainerControl.prototype),Footer.prototype.GetControlPoints=function(){var a=new Point(this.Location.x+this.Size.Width/2,this.Location.y),b=[a];return b},Footer.prototype.MoveResize=function(a,b,c){switch(c){case 1:this.Size=new Size(this.Size.Width,this.Size.Height+b),this.Location=new Point(this.Location.x,this.Location.y-b),this.OnResize(),this.Render()}},Panel.prototype=Object.create(ContainerControl.prototype),Panel.prototype.GetInstance=function(){return new Panel(this.Location,this.Size)},RichTextBox.prototype=Object.create(ContainerControl.prototype),RichTextBox.prototype.EditMode=!1,RichTextBox.prototype.LineIndex=1,RichTextBox.prototype.OnSetParent=function(){if(null!=this.Parent){Visual.prototype.OnSetParent.call(this);var a=this;this.Parent.AddPaintInitEventListener(function(){a.Parent_PaintInit()}),this.Parent.AddKeyPressEventListener(new KeyPressEventListener(function(b){a.GeoPort_KeyPress(b)})),Keyboard.keyDown(function(b){a.GeoPort_KeyPress(b)})}},RichTextBox.prototype.Parent_PaintInit=function(){},RichTextBox.prototype.GeoPort_KeyPress=function(a){this.KeyPress(a)},RichTextBox.prototype.MoveResize=function(a,b,c){this.EditMode||ContainerControl.prototype.MoveResize.call(this,a,b,c)},RichTextBox.prototype.GetInstance=function(){return new RichTextBox(this.Location,this.Size)};